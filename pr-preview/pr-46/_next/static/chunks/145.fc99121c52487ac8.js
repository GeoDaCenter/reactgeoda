"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[145],{23145:function(e,t,n){n.a(e,async function(e,r){try{n.r(t),n.d(t,{DuckDBTableComponent:function(){return v},processArrowTable:function(){return T}});var a=n(50029),o=n(90116),s=n(87794),u=n.n(s),i=n(67294),c=n(9473),l=n(77507),f=n(63764),p=n(80208),m=n(80892),d=n(24836),y=n(75485),x=n(35599),w=e([x]);x=(w.then?(await w)():w)[0];var b=i.createElement,h=(0,p.pfw)();function T(e){var t=[];e.schema.fields.forEach(function(e,n){var r,a=null===(r=e.metadata.get("ARROW:extension:name"))||void 0===r?void 0:r.startsWith("geoarrow");t.push({name:e.name,id:e.name,displayName:e.name,format:"",fieldIdx:n,type:a?y.ALL_FIELD_TYPES.geoarrow:(0,d.arrowDataTypeToFieldType)(e.type),analyzerType:a?l.DATA_TYPES.GEOMETRY:(0,d.arrowDataTypeToAnalyzerDataType)(e.type),valueAccessor:function(e){return function(t){return e.valueAt(t.index,n)}},metadata:e.metadata})});var n=(0,o.Z)(Array(e.numCols).keys()).map(function(t){return e.getChildAt(t)});return{fields:t,rows:[],cols:n,metadata:e.schema.metadata}}function v(){var e,t=(0,c.I0)(),n=(0,i.useState)(""),r=n[0],o=n[1],s=p.ITH.get(p.T_F),l=(0,c.v9)(function(e){return e.root}),d=l.file.rawFileData.name,y=(0,c.v9)(function(e){return e.keplerGl.kepler_map}),w=h(t,{}),T=w.visStateActions,v=w.uiStateActions,E=(0,x.b)(),k=E.query,g=E.importArrowFile,A=(e=(0,a.Z)(u().mark(function e(){var n;return u().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k(r);case 2:n=e.sent,console.log("query result",n),n&&t({type:"SET_FILTER_INDEXES",payload:{dataLabel:d,filteredIndex:n}});case 5:case"end":return e.stop()}},e)})),function(){return e.apply(this,arguments)}),C=function(e){e&&o(e)};return(0,i.useEffect)(function(){console.log("useEffect importArrowFile"),g(l.file.rawFileData),o('select * from "'.concat(d,'" LIMIT 5'))},[]),b("div",{className:"item-center flex w-full flex-col p-5",style:{height:"80vh",minWidth:"50vw",padding:"20px"}},b("div",{className:"flex w-full basis-1/4 flex-col items-center justify-center"},b("div",{className:"h-20 w-full rounded border-2 border-solid border-rose-800 p-1"},b(f.ZP,{language:"sql",value:r,onChange:C,options:{minimap:{enabled:!1}}})),b("div",{className:"m-2 flex w-full flex-row items-start space-x-4"},b("button",{onClick:A,className:"inline-flex items-center rounded bg-gray-300 px-4 py-2 text-gray-800 hover:bg-gray-400"},"Query"),b("button",{className:"inline-flex items-center rounded bg-gray-300 px-4 py-2 text-gray-800 hover:bg-gray-400"},"Reset"))),b(s,{datasets:y.visState.datasets,dataId:Object.keys(y.visState.datasets)[0],showDatasetTable:T.showDatasetTable,sortTableColumn:T.sortTableColumn,pinTableColumn:T.pinTableColumn,copyTableColumn:T.copyTableColumn,setColumnDisplayFormat:T.setColumnDisplayFormat,uiStateActions:v,uiState:y.uiState,showTab:!1,theme:m.theme}))}t.default=v,r()}catch(E){r(E)}})},35599:function(e,t,n){n.a(e,async function(e,r){try{n.d(t,{b:function(){return y}});var a=n(50029),o=n(87794),s=n.n(o),u=n(67294),i=n(11321),c=n(88022),l=n(4413),f=n(78514),p={mvp:{mainModule:l,mainWorker:new n.U(n(83123)).toString()},eh:{mainModule:f,mainWorker:new n.U(n(87736)).toString()}},m=null;function d(){return(d=(0,a.Z)(s().mark(function e(){var t,n,r;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==m){e.next=12;break}return e.next=3,new Promise(function(e){return setTimeout(e,2e3)});case 3:return e.next=5,c.Dn(p);case 5:return t=e.sent,n=new Worker(t.mainWorker),r=new c.kw,m=new c.ak(r,n),e.next=11,m.instantiate(t.mainModule,t.pthreadWorker);case 11:return e.abrupt("return",m);case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}},e)}))).apply(this,arguments)}function y(){var e,t,n=(0,u.useCallback)((e=(0,a.Z)(s().mark(function e(t){var n,r,a,o,u;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(t=t.trim()).substring(0,6).toUpperCase(),!("SELECT"!==r)){e.next=4;break}throw Error("Only SELECT queries are supported");case 4:if(m){e.next=6;break}throw Error("DuckDB is not initialized");case 6:return t="SELECT row_index AS selected_index, ".concat(t.substring(6)),e.next=9,m.connect();case 9:return a=e.sent,e.next=12,a.query(t);case 12:return o=e.sent,u=null===(n=o.getChildAt(0))||void 0===n?void 0:n.toArray(),e.next=16,a.close();case 16:return e.abrupt("return",u||[]);case 17:case"end":return e.stop()}},e)})),function(t){return e.apply(this,arguments)}),[]),r=(0,u.useCallback)((t=(0,a.Z)(s().mark(function e(t){var n,r,a,o,u,c;return s().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!m){e.next=24;break}return e.next=3,m.connect();case 3:return n=e.sent,r=t.name,e.next=7,n.query("select * from information_schema.tables");case 7:if((0,e.sent).toArray().map(function(e){return e.toJSON()}).some(function(e){return e.table_name===r})){e.next=22;break}return e.next=12,t.arrayBuffer();case 12:return u=e.sent,c=i.p(u),e.next=16,n.insertArrowTable(c,{name:r});case 16:return e.next=18,n.query('ALTER TABLE "'.concat(r,'" ADD COLUMN row_index INTEGER DEFAULT 0'));case 18:return e.next=20,n.query("CREATE SEQUENCE serial");case 20:return e.next=22,n.query('UPDATE "'.concat(r,"\" SET row_index = nextval('serial') - 1"));case 22:return e.next=24,n.close();case 24:case"end":return e.stop()}},e)})),function(e){return t.apply(this,arguments)}),[]);return{query:n,importArrowFile:r}}m=await function(){return d.apply(this,arguments)}(),r()}catch(x){r(x)}},1)}}]);