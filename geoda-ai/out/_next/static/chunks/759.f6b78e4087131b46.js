"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[759],{82759:function(e,t,a){a.r(t),a.d(t,{DuckDBTableComponent:function(){return w},processArrowTable:function(){return f}});var n=a(57437),r=a(2265),l=a(16347),o=a(45706),i=a(61152),s=a(2910),u=a(39668),c=a(94241),m=a(89687),d=a(91806);let y=(0,s.pfw)(),p=s.ITH.get(s.m7x);function f(e){let t=[];return e.schema.fields.forEach((e,a)=>{var n;let r=null===(n=e.metadata.get("ARROW:extension:name"))||void 0===n?void 0:n.startsWith("geoarrow");t.push({name:e.name,id:e.name,displayName:e.name,format:"",fieldIdx:a,type:r?c.ALL_FIELD_TYPES.geoarrow:(0,u.arrowDataTypeToFieldType)(e.type),analyzerType:r?o.DATA_TYPES.GEOMETRY:(0,u.arrowDataTypeToAnalyzerDataType)(e.type),valueAccessor:e=>t=>e.valueAt(t.index,a),metadata:e.metadata})}),{fields:t,rows:[],cols:[...Array(e.numCols).keys()].map(t=>e.getChildAt(t)),metadata:e.schema.metadata}}function w(){let e=(0,l.I0)(),t=(0,d.Fg)(),[a,o]=(0,r.useState)(""),u=(0,l.v9)(e=>e.root.file.rawFileData),c=u.name,f=(0,l.v9)(e=>e.keplerGl.kepler_map),w=(0,r.useMemo)(()=>Object.values(f.visState.datasets)[0],[f.visState.datasets]),b=(0,r.useMemo)(()=>Object.keys(f.visState.datasets)[0],[f.visState.datasets]),{fields:h,dataContainer:E,pinnedColumns:T,filteredIndex:x}=w,C=(0,r.useMemo)(()=>{let e={};return x.forEach(t=>{e[t]=!0}),e},[x]),g=(0,r.useMemo)(()=>h.map(e=>e.name),[h]),v=(0,r.useMemo)(()=>h.reduce((e,t)=>{let{name:a,displayName:n,type:r,filterProps:l,format:o,displayFormat:i}=t;return{...e,[a]:{name:n||a,type:r,...o?{format:o}:{},...i?{displayFormat:i}:{},...(null==l?void 0:l.columnStats)?{columnStats:l.columnStats}:{}}}},{}),[h]),S=(0,r.useMemo)(()=>h.reduce((e,a,n)=>({...e,[a.name]:(0,s.pqN)({text:{dataContainer:E,column:a.displayName},colIdx:n,type:a.type,fontSize:t.cellFontSize,font:t.fontFamily,minCellSize:122})}),{}),[h,E,t.cellFontSize,t.fontFamily]),{visStateActions:A}=y(e,{}),{query:k,importArrowFile:D}=(0,m.bW)(),N=async()=>{let t=await k(a);t&&e({type:"SET_FILTER_INDEXES",payload:{dataLabel:c,filteredIndex:t}})};return(0,r.useEffect)(()=>{D(u),o('select * from "'.concat(c,'"'))},[u,D,c]),(0,n.jsxs)("div",{className:"item-center flex w-full flex-col p-5",style:{height:"100%",minWidth:"50vw",padding:"20px"},children:[(0,n.jsxs)("div",{className:"flex w-full basis-1/4 flex-col items-center justify-center",children:[(0,n.jsx)("div",{className:"h-20 w-full rounded border-2 border-solid border-rose-800 p-1",children:(0,n.jsx)(i.ZP,{language:"sql",value:a,onChange:e=>{e&&o(e)},options:{minimap:{enabled:!1}}})}),(0,n.jsxs)("div",{className:"m-2 flex w-full flex-row items-start space-x-4",children:[(0,n.jsx)("button",{onClick:N,className:"inline-flex items-center rounded bg-gray-300 px-4 py-2 text-gray-800 hover:bg-gray-400",children:"Query"}),(0,n.jsx)("button",{className:"inline-flex items-center rounded bg-gray-300 px-4 py-2 text-gray-800 hover:bg-gray-400",children:"Reset"})]})]}),(0,n.jsx)(p,{dataId:b,columns:g,colMeta:v,cellSizeCache:S,dataContainer:E,filteredIndex:C,pinnedColumns:T,sortColumn:{},sortTableColumn:A.sortTableColumn,pinTableColumn:A.pinTableColumn,copyTableColumn:A.copyTableColumn,setColumnDisplayFormat:A.setColumnDisplayFormat,theme:t},b)]})}t.default=w},89687:function(e,t,a){a.d(t,{Zi:function(){return d},bW:function(){return y}});var n=a(2265),r=a(79121),l=a(37037),o=a(41762);let i={mvp:{mainModule:l,mainWorker:new a.U(a(82471)).toString()},eh:{mainModule:o,mainWorker:new a.U(a(37770)).toString()}},s=null,u=null,c=null;async function m(){if(null===s){await new Promise(e=>setTimeout(e,2e3));let e=await r.Dn(i),t=new Worker(e.mainWorker),a=new r.kw;return s=new r.ak(a,t),await s.instantiate(e.mainModule,e.pthreadWorker),s}return null}async function d(e){if(s){if(!c){!u&&e&&(u=e);try{let e=await s.connect(),t=(await e.query('SUMMARIZE "'.concat(u,'"'))).toArray().map(e=>e.toJSON());await e.close();let a=t.map(e=>Object.values(e).join(",")).join("\n"),n=Object.keys(t[0]).join(",");c="".concat(n,"\n").concat(a)}catch(e){return"error: can not get summary of the table because table name is not found"}}return c}return"Error: can not get summary of the table because the duckdb is not working properly."}function y(){return{query:(0,n.useCallback)(async e=>{var t;if("SELECT"!==(e=e.trim()).substring(0,6).toUpperCase())throw Error("Only SELECT queries are supported");if(!s)throw Error("DuckDB is not initialized");e="SELECT row_index AS selected_index, ".concat(e.substring(6));let a=await s.connect(),n=null===(t=(await a.query(e)).getChildAt(0))||void 0===t?void 0:t.toArray();return await a.close(),n||[]},[]),importArrowFile:(0,n.useCallback)(async e=>{let{name:t,arrowTable:a}=e;if(s){let e=await s.connect();if(!(await e.query("select * from information_schema.tables")).toArray().map(e=>e.toJSON()).some(e=>e.table_name===t))try{await e.insertArrowTable(a,{name:t}),await e.query('ALTER TABLE "'.concat(t,'" ADD COLUMN row_index INTEGER DEFAULT 0')),await e.query("CREATE SEQUENCE serial"),await e.query('UPDATE "'.concat(t,"\" SET row_index = nextval('serial') - 1")),await d()}catch(e){}await e.close()}},[])}}setTimeout(async()=>{s=await m()},200)}}]);