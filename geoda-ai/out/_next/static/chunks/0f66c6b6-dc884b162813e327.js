!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a96f3525-18a5-42aa-be98-3fd128767a4b",e._sentryDebugIdIdentifier="sentry-dbid-a96f3525-18a5-42aa-be98-3fd128767a4b")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[764],{63406:function(e,t,l){l.d(t,{ZP:function(){return tQ},_z:function(){return G},x9:function(){return ej}});var r=l(2265),a=l(16347),o=l(20508),n=l(65213),s=l(26870),i=l(97355),u=Object.defineProperty;((e,t)=>{for(var l in t)u(e,l,{get:t[l],enumerable:!0})})({},{errorBothQueryDefaultQuery:()=>h,errorControlledToUncontrolled:()=>b,errorDeprecatedRuleGroupProps:()=>p,errorDeprecatedRuleProps:()=>m,errorEnabledDndWithoutReactDnD:()=>g,errorInvalidIndependentCombinatorsProp:()=>c,errorUncontrolledToControlled:()=>f,errorUnnecessaryIndependentCombinatorsProp:()=>d});var c="QueryBuilder was rendered with a truthy independentCombinators prop. This prop is deprecated and unnecessary. Furthermore, the initial query/defaultQuery prop was of type RuleGroupType instead of type RuleGroupIC. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",d="QueryBuilder was rendered with the deprecated and unnecessary independentCombinators prop. To use independent combinators, make sure the query/defaultQuery prop is of type RuleGroupIC when the component mounts. More info: https://react-querybuilder.js.org/docs/components/querybuilder#independent-combinators",p="A custom RuleGroup component has rendered a standard RuleGroup component with deprecated props. The combinator, not, and rules props should not be used. Instead, the full group object should be passed as the ruleGroup prop.",m="A custom RuleGroup component has rendered a standard Rule component with deprecated props. The field, operator, value, and valueSource props should not be used. Instead, the full rule object should be passed as the rule prop.",h="QueryBuilder was rendered with both query and defaultQuery props. QueryBuilder must be either controlled or uncontrolled (specify either the query prop, or the defaultQuery prop, but not both). Decide between using a controlled or uncontrolled query builder and remove one of these props. More info: https://reactjs.org/link/controlled-components",f="QueryBuilder is changing from an uncontrolled component to be controlled. This is likely caused by the query changing from undefined to a defined value, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",b="QueryBuilder is changing from a controlled component to be uncontrolled. This is likely caused by the query changing from defined to undefined, which should not happen. Decide between using a controlled or uncontrolled query builder for the lifetime of the component. More info: https://reactjs.org/link/controlled-components",g="QueryBuilder was rendered with the enableDragAndDrop prop set to true, but either react-dnd or react-dnd-html5-backend (or both) was not installed. To enable drag-and-drop functionality, install both packages and wrap QueryBuilder in QueryBuilderDnD from @react-querybuilder/dnd.",v=({className:e,handleOnClick:t,label:l,title:a,disabled:o,disabledTranslation:n,testID:s})=>r.createElement("button",{type:"button","data-testid":s,disabled:o&&!n,className:e,title:n&&o?n.title:a,onClick:e=>t(e)},n&&o?n.label:l);v.displayName="ActionElement";var $=(0,r.forwardRef)(({className:e,label:t,title:l,testID:a},o)=>r.createElement("span",{"data-testid":a,ref:o,className:e,title:l},t));$.displayName="DragHandle";var y="------",E=",",N={fields:{title:"Fields",placeholderName:"~",placeholderLabel:y,placeholderGroupLabel:y},operators:{title:"Operators",placeholderName:"~",placeholderLabel:y,placeholderGroupLabel:y},value:{title:"Value"},removeRule:{label:"⨯",title:"Remove rule"},removeGroup:{label:"⨯",title:"Remove group"},addRule:{label:"+ Rule",title:"Add rule"},addGroup:{label:"+ Group",title:"Add group"},combinators:{title:"Combinators"},notToggle:{label:"Not",title:"Invert this group"},cloneRule:{label:"⧉",title:"Clone rule"},cloneRuleGroup:{label:"⧉",title:"Clone group"},shiftActionUp:{label:"˄",title:"Shift up"},shiftActionDown:{label:"˅",title:"Shift down"},dragHandle:{label:"⁞⁞",title:"Drag handle"},lockRule:{label:"\uD83D\uDD13",title:"Lock rule"},lockGroup:{label:"\uD83D\uDD13",title:"Lock group"},lockRuleDisabled:{label:"\uD83D\uDD12",title:"Unlock rule"},lockGroupDisabled:{label:"\uD83D\uDD12",title:"Unlock group"},valueSourceSelector:{title:"Value source"}},G=[{name:"=",value:"=",label:"="},{name:"!=",value:"!=",label:"!="},{name:"<",value:"<",label:"<"},{name:">",value:">",label:">"},{name:"<=",value:"<=",label:"<="},{name:">=",value:">=",label:">="},{name:"contains",value:"contains",label:"contains"},{name:"beginsWith",value:"beginsWith",label:"begins with"},{name:"endsWith",value:"endsWith",label:"ends with"},{name:"doesNotContain",value:"doesNotContain",label:"does not contain"},{name:"doesNotBeginWith",value:"doesNotBeginWith",label:"does not begin with"},{name:"doesNotEndWith",value:"doesNotEndWith",label:"does not end with"},{name:"null",value:"null",label:"is null"},{name:"notNull",value:"notNull",label:"is not null"},{name:"in",value:"in",label:"in"},{name:"notIn",value:"notIn",label:"not in"},{name:"between",value:"between",label:"between"},{name:"notBetween",value:"notBetween",label:"not between"}],R=[{name:"and",value:"and",label:"AND"},{name:"or",value:"or",label:"OR"}];[...R];var k={queryBuilder:"queryBuilder",ruleGroup:"ruleGroup",header:"ruleGroup-header",body:"ruleGroup-body",combinators:"ruleGroup-combinators",addRule:"ruleGroup-addRule",addGroup:"ruleGroup-addGroup",cloneRule:"rule-cloneRule",cloneGroup:"ruleGroup-cloneGroup",removeGroup:"ruleGroup-remove",notToggle:"ruleGroup-notToggle",rule:"rule",fields:"rule-fields",operators:"rule-operators",value:"rule-value",removeRule:"rule-remove",betweenRules:"betweenRules",valid:"queryBuilder-valid",invalid:"queryBuilder-invalid",shiftActions:"shiftActions",dndDragging:"dndDragging",dndOver:"dndOver",dragHandle:"queryBuilder-dragHandle",disabled:"queryBuilder-disabled",lockRule:"rule-lock",lockGroup:"ruleGroup-lock",valueSource:"rule-valueSource",valueListItem:"rule-value-list-item"},w={queryBuilder:"",ruleGroup:"",header:"",body:"",combinators:"",addRule:"",addGroup:"",cloneRule:"",cloneGroup:"",removeGroup:"",notToggle:"",rule:"",fields:"",operators:"",value:"",removeRule:"",shiftActions:"",dragHandle:"",lockRule:"",lockGroup:"",valueSource:"",actionElement:"",valueSelector:""},C={rule:"rule",ruleGroup:"rule-group",inlineCombinator:"inline-combinator",addGroup:"add-group",removeGroup:"remove-group",cloneGroup:"clone-group",cloneRule:"clone-rule",addRule:"add-rule",removeRule:"remove-rule",combinators:"combinators",fields:"fields",operators:"operators",valueEditor:"value-editor",notToggle:"not-toggle",shiftActions:"shift-actions",dragHandle:"drag-handle",lockRule:"lock-rule",lockGroup:"lock-group",valueSourceSelector:"value-source-selector"},A={parentPathDisabled:"action aborted: parent path disabled",pathDisabled:"action aborted: path is disabled",onAddRuleFalse:"onAddRule callback returned false",onAddGroupFalse:"onAddGroup callback returned false",onRemoveFalse:"onRemove callback returned false",add:"rule or group added",remove:"rule or group removed",update:"rule or group updated",move:"rule or group moved"},S=({component:e,independentCombinators:t,...l})=>r.createElement("div",{className:k.betweenRules,"data-testid":C.inlineCombinator},r.createElement(e,{...l,testID:C.combinators}));S.displayName="InlineCombinator";var D=({className:e,handleOnChange:t,title:l,label:a,checked:o,disabled:n,testID:s})=>r.createElement("label",{"data-testid":s,className:e,title:l},r.createElement("input",{type:"checkbox",onChange:e=>t(e.target.checked),checked:!!o,disabled:n}),a);D.displayName="NotToggle";var x=e=>{let t=(0,r.useRef)({value:e,prev:null}),l=t.current.value;return e!==l&&(t.current={value:e,prev:l}),t.current.prev},M=({defaultQuery:e,queryProp:t})=>{x(!!t)},W=(e,t=E)=>"string"==typeof e?e.split(`\\${t}`).map(e=>e.split(t)).reduce((e,l,r)=>0===r?l:[...e.slice(0,e.length-1),`${e[e.length-1]}${t}${l[0]}`,...l.slice(1)],[]):[],O=(e,t=E)=>e.map(e=>`${e??""}`.replaceAll(t,`\\${t}`)).join(t),B=e=>"string"==typeof e?e.trim():e,I=e=>Array.isArray(e)?e.map(B):"string"==typeof e?W(e,E).filter(e=>!/^\s*$/.test(e)).map(e=>e.trim()):"number"==typeof e?[e]:[],q=new RegExp(o.dF.source.replace(/^\^/,"^\\s*").replace(/\$$/,"\\s*$")),T=e=>null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype,U=e=>T(e)&&"rules"in e&&Array.isArray(e.rules),j=e=>U(e)&&"string"==typeof e.combinator,L=e=>U(e)&&void 0===e.combinator,Q=e=>U(e)?H(e):e,H=e=>{let t=[],l=e=>t.push(Q(e)),r=0;for(let a=0;a<e.rules.length;a+=2)if(1===e.rules.length)l(e.rules[0]);else if("and"===e.rules[a+1]){r=a;let l=1;for(;"and"===e.rules[r+l];)a+=2,l+=2;t.push({rules:e.rules.slice(r,a+1).map(Q)}),a-=2}else"or"===e.rules[a+1]&&(0===a||a===e.rules.length-3?((0===a||"or"===e.rules[a-1])&&l(e.rules[a]),l(e.rules[a+1]),a===e.rules.length-3&&l(e.rules[a+2])):("and"===e.rules[a-1]||l(e.rules[a]),l(e.rules[a+1])));return 1===t.length&&"object"==typeof t[0]&&U(t[0])?{...e,...t[0]}:{...e,rules:t}},P=e=>{if(j(e))return e;let t=H(e),l=t.rules.map(e=>"string"!=typeof e&&U(e)?P(e):e),r=l.length<2?"and":l[1],a=l.filter(e=>"string"!=typeof e);return{...t,combinator:r,rules:a}},F=e=>T(e)&&"name"in e&&"string"==typeof e.name,_=e=>T(e)&&"value"in e&&"string"==typeof e.value;function V(e){return(0,n.Uy)(e=>{F(e)&&!_(e)?e.value=e.name:!F(e)&&_(e)&&(e.name=e.value)})(e)}function z(e){return Array.isArray(e)?(0,n.Uy)(e=>{if(ee(e))for(let t of e)t.options.forEach((e,l)=>t.options[l]=V(e));else e.forEach((t,l)=>e[l]=V(t))})(e):[]}function J(e){return Object.fromEntries(Object.entries(e).map(([e,t])=>[e,V(t)]))}var K=e=>{let t=new Set,l=[];return e.forEach(e=>{t.has(e.value??e.name)||(t.add(e.value??e.name),l.push(e))}),e.length===l.length?e:l},Z=e=>{let t=new Set,l=new Set,r=[];return e.forEach(e=>{if(!t.has(e.label)){t.add(e.label);let a=[];e.options.forEach(e=>{l.has(e.value??e.name)||(l.add(e.value??e.name),a.push(V(e)))}),r.push({...e,options:a})}}),r},X=e=>ee(e)?Z(e):K(e.map(V)),Y=e=>Array.isArray(e)&&e.length>0&&T(e[0])&&"options"in e[0],ee=e=>Array.isArray(e)&&e.length>0&&T(e[0])&&"options"in e[0]&&T(e[0].options[0])&&("name"in e[0].options[0]||"value"in e[0].options[0]),et=(e,t)=>(Y(e)?e.flatMap(e=>e.options):e).find(e=>e.name===t),el=e=>Array.isArray(e)&&0!==e.length?ee(e)?e[0].options[0].value??e[0].options[0].name:e[0].value??e[0].name:null,er=e=>K(Y(e)?e.flatMap(e=>e.options):e),ea=(e,t,l)=>{let r=V(e),a=V(l);return r.value!==a.value&&("string"==typeof r.comparator?r[r.comparator]===a[r.comparator]:r.comparator?.(a,t)??!1)},eo=(e,t,l)=>{if(!e.comparator){let l=t=>(t.value??t.name)!==(e.value??e.name);return ee(t)?t.map(e=>({...e,options:e.options.filter(l)})):t.filter(l)}return ee(t)?t.map(t=>({...t,options:t.options.filter(t=>ea(e,l,t))})).filter(e=>e.options.length>0):t.filter(t=>ea(e,l,t))},en=(e,{parseNumbers:t}={})=>{if(!t||"bigint"==typeof e||"number"==typeof e)return e;if("native"===t)return parseFloat(e);let l=(0,o.Xl)(e,{allowTrailingInvalid:"enhanced"===t,romanNumerals:!0,round:!1});return isNaN(l)?e:l},es=e=>{switch(e.toLowerCase()){case"null":return"is null";case"notnull":return"is not null";case"notin":return"not in";case"notbetween":return"not between";case"contains":case"beginswith":case"endswith":return"like";case"doesnotcontain":case"doesnotbeginwith":case"doesnotendwith":return"not like";default:return e}},ei={"=":"$eq","!=":"$ne","<":"$lt","<=":"$lte",">":"$gt",">=":"$gte",in:"$in",notIn:"$nin"},eu={and:"&&",or:"||"},ec=e=>({...e,rules:e.rules.map(e=>{if("string"==typeof e)return e;if(U(e))return ec(e);let{value:t}=e;return"string"==typeof t&&(t=en(t,{parseNumbers:!0})),{...e,value:t}})}),ed=e=>"string"==typeof e&&e.length>0||"number"==typeof e&&!isNaN(e)||"string"!=typeof e&&"number"!=typeof e,ep=(e,t)=>t&&("number"==typeof e||"bigint"==typeof e||"string"==typeof e&&q.test(e)),em=e=>e.length>=3,eh=(e=["",""])=>Array.isArray(e)?e:"string"==typeof e?[e,e]:e??["",""],ef=e=>/^(does)?not/i.test(e),eb=(e,t)=>"string"==typeof e&&t?e.replaceAll('"','\\"'):e,eg=({field:e,operator:t,value:l,valueSource:r},{escapeQuotes:a,parseNumbers:o}={})=>{let n="field"===r,s=t.replace(/^=$/,"=="),i="number"==typeof l||"boolean"==typeof l||"bigint"==typeof l||ep(l,o);switch(s){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${s} ${n||i?B(l):`"${eb(l,a)}"`}`;case"contains":case"doesNotContain":{let t=ef(s)?"!":"";return`${t}${e}.contains(${n?B(l):`"${eb(l,a)}"`})`}case"beginsWith":case"doesNotBeginWith":{let t=ef(s)?"!":"";return`${t}${e}.startsWith(${n?B(l):`"${eb(l,a)}"`})`}case"endsWith":case"doesNotEndWith":{let t=ef(s)?"!":"";return`${t}${e}.endsWith(${n?B(l):`"${eb(l,a)}"`})`}case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{let t=ef(s),r=I(l);if(r.length>0)return`${t?"!(":""}${e} in [${r.map(e=>n||ep(e,o)?`${B(e)}`:`"${eb(e,a)}"`).join(", ")}]${t?")":""}`;break}case"between":case"notBetween":{let r=I(l);if(r.length>=2&&r[0]&&r[1]){let[l,o]=r,s=ep(l,!0)?en(l,{parseNumbers:!0}):NaN,i=ep(o,!0)?en(o,{parseNumbers:!0}):NaN,u=isNaN(s)?n?`${l}`:`"${eb(l,a)}"`:s,c=isNaN(i)?n?`${o}`:`"${eb(o,a)}"`:i;if(u===s&&c===i&&i<s&&(c=s,u=i),"between"===t)return`(${e} >= ${u} && ${e} <= ${c})`;return`(${e} < ${u} || ${e} > ${c})`}}}return""},ev=e=>"string"!=typeof e?e:e.replaceAll("\\","\\\\").replaceAll('"','\\"'),e$=({field:e,operator:t,value:l,valueSource:r},{parseNumbers:a}={})=>{let o="field"===r,n="number"==typeof l||"boolean"==typeof l||"bigint"==typeof l||ep(l,a);if("="===t&&!o)return`{"${e}":${n?B(l):`"${ev(l)}"`}}`;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":{let r=ei[t];return o?`{"$expr":{"${r}":["$${e}","$${l}"]}}`:`{"${e}":{"${r}":${n?B(l):`"${ev(l)}"`}}}`}case"contains":return o?`{"$where":"this.${e}.includes(this.${l})"}`:`{"${e}":{"$regex":"${ev(l)}"}}`;case"beginsWith":return o?`{"$where":"this.${e}.startsWith(this.${l})"}`:`{"${e}":{"$regex":"^${ev(l)}"}}`;case"endsWith":return o?`{"$where":"this.${e}.endsWith(this.${l})"}`:`{"${e}":{"$regex":"${ev(l)}$"}}`;case"doesNotContain":return o?`{"$where":"!this.${e}.includes(this.${l})"}`:`{"${e}":{"$not":{"$regex":"${ev(l)}"}}}`;case"doesNotBeginWith":return o?`{"$where":"!this.${e}.startsWith(this.${l})"}`:`{"${e}":{"$not":{"$regex":"^${ev(l)}"}}}`;case"doesNotEndWith":return o?`{"$where":"!this.${e}.endsWith(this.${l})"}`:`{"${e}":{"$not":{"$regex":"${ev(l)}$"}}}`;case"null":return`{"${e}":null}`;case"notNull":return`{"${e}":{"$ne":null}}`;case"in":case"notIn":{let r=I(l);if(r.length>0)return o?`{"$where":"${"notIn"===t?"!":""}[${r.map(e=>`this.${e}`).join(",")}].includes(this.${e})"}`:`{"${e}":{"${ei[t]}":[${r.map(e=>ep(e,a)?`${B(e)}`:`"${ev(e)}"`).join(",")}]}}`;break}case"between":case"notBetween":{let r=I(l);if(r.length>=2&&ed(r[0])&&ed(r[1])){let[l,a]=r,n=ep(l,!0)?en(l,{parseNumbers:!0}):NaN,s=ep(a,!0)?en(a,{parseNumbers:!0}):NaN,i=o||!isNaN(n)?`${l}`:`"${ev(l)}"`,u=o||!isNaN(s)?`${a}`:`"${ev(a)}"`;if("between"===t)return o?`{"$and":[{"$expr":{"$gte":["$${e}","$${i}"]}},{"$expr":{"$lte":["$${e}","$${u}"]}}]}`:`{"${e}":{"$gte":${i},"$lte":${u}}}`;return o?`{"$or":[{"$expr":{"$lt":["$${e}","$${i}"]}},{"$expr":{"$gt":["$${e}","$${u}"]}}]}`:`{"$or":[{"${e}":{"$lt":${i}}},{"${e}":{"$gt":${u}}}]}`}}}return""},ey=e=>/^(does)?not/i.test(e),eE=(e,t)=>t?`!(${e})`:`${e}`,eN=(e,t)=>"string"==typeof e&&t?e.replaceAll("'","\\'"):e,eG=({field:e,operator:t,value:l,valueSource:r},{escapeQuotes:a,parseNumbers:o}={})=>{let n="field"===r,s=t.replace(/^=$/,"=="),i="number"==typeof l||"boolean"==typeof l||"bigint"==typeof l||ep(l,o);switch(s){case"<":case"<=":case"==":case"!=":case">":case">=":return`${e} ${s} ${n||i?B(l):`'${eN(l,a)}'`}`;case"contains":case"doesNotContain":return eE(`${e} matches ${n||i?B(l):`'${eN(l,a)}'`}`,ey(s));case"beginsWith":case"doesNotBeginWith":{let t=n?`'^'.concat(${B(l)})`:`'${"string"==typeof l&&!l.startsWith("^")||i?"^":""}${eN(l,a)}'`;return eE(`${e} matches ${t}`,ey(s))}case"endsWith":case"doesNotEndWith":{let t=n?`${B(l)}.concat('$')`:`'${eN(l,a)}${"string"==typeof l&&!l.endsWith("$")||i?"$":""}'`;return eE(`${e} matches ${t}`,ey(s))}case"null":return`${e} == null`;case"notNull":return`${e} != null`;case"in":case"notIn":{let t=ey(s)?"!":"",r=I(l);if(r.length>0)return`${t}(${r.map(t=>`${e} == ${n||ep(t,o)?`${B(t)}`:`'${eN(t,a)}'`}`).join(" or ")})`;break}case"between":case"notBetween":{let r=I(l);if(r.length>=2&&r[0]&&r[1]){let[l,o]=r,s=ep(l,!0)?en(l,{parseNumbers:!0}):NaN,i=ep(o,!0)?en(o,{parseNumbers:!0}):NaN,u=isNaN(s)?n?`${l}`:`'${eN(l,a)}'`:s,c=isNaN(i)?n?`${o}`:`'${eN(o,a)}'`:i;if(u===s&&c===i&&i<s&&(c=s,u=i),"between"===t)return`(${e} >= ${u} and ${e} <= ${c})`;return`(${e} < ${u} or ${e} > ${c})`}}}return""},eR=(e,t)=>t&&"string"==typeof e?e.replaceAll("'","''"):e,ek=({operator:e,value:t,valueSource:l},{escapeQuotes:r,parseNumbers:a,quoteFieldNamesWith:o}={})=>{let n="field"===l,[s,i]=eh(o),u=e.toLowerCase(),c=e=>`${s}${e}${i}`;switch(u){case"null":case"notnull":return"";case"in":case"notin":{let e=I(t);if(e.length>0)return`(${e.map(e=>n?c(e):ep(e,a)?`${B(e)}`:`'${eR(e,r)}'`).join(", ")})`;return""}case"between":case"notbetween":{let e=I(t);if(e.length>=2&&ed(e[0])&&ed(e[1])){let[t,l]=e;return n?`${c(t)} and ${c(l)}`:ep(t,a)&&ep(l,a)?`${B(t)} and ${B(l)}`:`'${eR(t,r)}' and '${eR(l,r)}'`}return""}case"contains":case"doesnotcontain":return n?`'%' || ${c(t)} || '%'`:`'%${eR(t,r)}%'`;case"beginswith":case"doesnotbeginwith":return n?`${c(t)} || '%'`:`'${eR(t,r)}%'`;case"endswith":case"doesnotendwith":return n?`'%' || ${c(t)}`:`'%${eR(t,r)}'`}return"boolean"==typeof t?t?"TRUE":"FALSE":n?c(t):ep(t,a)?`${B(t)}`:`'${eR(t,r)}'`},ew={"<":"lt","<=":"lte",">":"gt",">=":"gte"},eC=(e,t)=>/^(does)?not/i.test(e)?{bool:{must_not:t}}:t,eA=e=>e?.replace(/('|\\)/g,"\\$1"),eS={beginsWith:"startsWith",doesNotContain:"contains",doesNotBeginWith:"startsWith",doesNotEndWith:"endsWith"},eD=(e,t,l)=>{let r=`doc['${e}'].${eS[t]??t}(doc['${l}'])`;return t.startsWith("d")?`!${r}`:r},ex=(e,t)=>"boolean"==typeof e?e:ep(e,t)?en(e,{parseNumbers:t}):e,eM=({field:e,operator:t,value:l,valueSource:r},{parseNumbers:a}={})=>{if("field"===r){if(I(l).some(e=>"string"!=typeof e))return!1;let r=eA(e);switch(t){case"=":case"!=":case">":case">=":case"<":case"<=":{let e="="===t?"==":t,a=eA(l);return!!a&&{bool:{filter:{script:{script:`doc['${r}'] ${e} doc['${a}']`}}}}}case"in":case"notIn":{let e=I(l);if(e.length>0){let l=e.map(e=>({bool:{filter:{script:{script:`doc['${r}'] == doc['${e}']`}}}}));return{bool:"in"===t?{should:l}:{must_not:l}}}return!1}case"between":case"notBetween":{let e=I(l);if(e.length>=2&&e[0]&&e[1]){let l=`doc['${r}'] >= doc['${e[0]}'] && doc['${r}'] <= doc['${e[1]}']`;return{bool:{filter:{script:{script:"notBetween"===t?`!(${l})`:l}}}}}return!1}case"contains":case"doesNotContain":case"beginsWith":case"doesNotBeginWith":case"endsWith":case"doesNotEndWith":{let e=eA(l);if(!e)return!1;return{bool:{filter:{script:{script:eD(r,t,e)}}}}}}}switch(t){case"<":case"<=":case">":case">=":return{range:{[e]:{[ew[t]]:ex(l,a)}}};case"=":return{term:{[e]:ex(l,a)}};case"!=":return{bool:{must_not:{term:{[e]:ex(l,a)}}}};case"null":return{bool:{must_not:{exists:{field:e}}}};case"notNull":return{exists:{field:e}};case"in":case"notIn":{let r=I(l).map(e=>ex(e,a));if(r.length>0){let l=r.map(t=>({term:{[e]:ex(t,a)}}));return{bool:"in"===t?{should:l}:{must_not:l}}}break}case"between":case"notBetween":{let r=I(l);if(r.length>=2&&ed(r[0])&&ed(r[1])){let[l,a]=r;if(ep(l,!0)&&ep(a,!0)){let e=en(l,{parseNumbers:!0}),t=en(a,{parseNumbers:!0});t<e?(a=e,l=t):(l=e,a=t)}return eC(t,{range:{[e]:{gte:l,lte:a}}})}break}case"contains":case"doesNotContain":return eC(t,{regexp:{[e]:{value:l}}});case"beginsWith":case"doesNotBeginWith":return eC(t,{regexp:{[e]:{value:`^${l}`}}});case"endsWith":case"doesNotEndWith":return eC(t,{regexp:{[e]:{value:`${l}$`}}})}return!1},eW=e=>e.replace(/^(=)$/,"$1=").replace(/^notNull$/i,"!=").replace(/^null$/i,"=="),eO=(e,t)=>/^(does)?not/i.test(e)?{"!":t}:t,eB=({field:e,operator:t,value:l,valueSource:r},{parseNumbers:a}={})=>{let o="field"===r,n={var:e},s=e=>o?{var:`${e}`}:ep(e,a)?en(e,{parseNumbers:a}):e;switch(t){case"<":case"<=":case"=":case"!=":case">":case">=":return{[eW(t)]:[n,s(l)]};case"null":case"notNull":return{[`${"notNull"===t?"!":"="}=`]:[n,null]};case"in":case"notIn":{let e=I(l).map(s);if(e.length>0)return eO(t,{in:[n,e]});break}case"between":case"notBetween":{let e=I(l);if(e.length>=2&&ed(e[0])&&ed(e[1])){let[l,r]=e;if(!o&&ep(l,!0)&&ep(r,!0)){let e=en(l,{parseNumbers:!0}),t=en(r,{parseNumbers:!0});t<e?(r=e,l=t):(l=e,r=t)}else o&&(l={var:l},r={var:r});return eO(t,{"<=":[l,n,r]})}break}case"contains":case"doesNotContain":return eO(t,{in:[s(l),n]});case"beginsWith":case"doesNotBeginWith":return eO(t,{startsWith:[n,s(l)]});case"endsWith":case"doesNotEndWith":return eO(t,{endsWith:[n,s(l)]})}return!1},eI=(e,t,l)=>{let{fieldData:r,format:a,getNextNamedParam:o,parseNumbers:n,paramPrefix:s,paramsKeepPrefix:i,numberedParams:u,quoteFieldNamesWith:c=["",""],valueProcessor:d=ek}=t??{},{processedParams:p=[]}=l??{},m="parameterized"===a,h=[],f={},b=e=>m?{sql:e,params:h}:{sql:e,params:f},g=d(e,{parseNumbers:n,quoteFieldNamesWith:c,fieldData:r,format:a}),v=es(e.operator),$=v.toLowerCase();if(("in"===$||"not in"===$||"between"===$||"not between"===$)&&!g)return b("");if("is null"===$||"is not null"===$)return b(`${c[0]}${e.field}${c[1]} ${v}`);if("field"===e.valueSource)return b(`${c[0]}${e.field}${c[1]} ${v} ${g}`.trim());if("in"===$||"not in"===$){let t=I(e.value);if(m)return t.forEach(e=>h.push(ep(e,n)?en(e,{parseNumbers:n}):e)),b(`${c[0]}${e.field}${c[1]} ${v} (${t.map((e,l)=>u?`${s}${p.length+1+t.length-(t.length-l)}`:"?").join(", ")})`);let l=[];return t.forEach(t=>{let r=o(e.field);l.push(`${s}${r}`),f[`${i?s:""}${r}`]=ep(t,n)?en(t,{parseNumbers:n}):t}),b(`${c[0]}${e.field}${c[1]} ${v} (${l.join(", ")})`)}if("between"===$||"not between"===$){let[t,l]=I(e.value).slice(0,2).map(e=>ep(e,n)?en(e,{parseNumbers:n}):e);if(m)return h.push(t),h.push(l),b(`${c[0]}${e.field}${c[1]} ${v} ${u?`${s}${p.length+1}`:"?"} and ${u?`${s}${p.length+2}`:"?"}`);let r=o(e.field),a=o(e.field);return f[`${i?s:""}${r}`]=t,f[`${i?s:""}${a}`]=l,b(`${c[0]}${e.field}${c[1]} ${v} ${s}${r} and ${s}${a}`)}let y=e.value;"string"==typeof e.value&&(y=ep(e.value,n)?en(e.value,{parseNumbers:n}):/^'.*'$/g.test(g)?g.replace(/(^'|'$)/g,""):g);let E="";return m?h.push(y):(E=o(e.field),f[`${i?s:""}${E}`]=y),b(`${c[0]}${e.field}${c[1]} ${v} ${m?u?`${s}${p.length+1}`:"?":`${s}${E}`}`.trim())},eq=(e,t)=>{let{parseNumbers:l,escapeQuotes:r,quoteFieldNamesWith:a=["",""],valueProcessor:o=ek}=t??{},n=o(e,{parseNumbers:l,escapeQuotes:r,quoteFieldNamesWith:a}),s=es(e.operator),i=s.toLowerCase();if(("in"===i||"not in"===i||"between"===i||"not between"===i)&&!n)return"";let[u,c]=eh(a);return`${u}${e.field}${c} ${s} ${n}`.trim()},eT=e=>T(e)&&"boolean"==typeof e.valid,eU=(e,t,l)=>{if("boolean"==typeof t)return t;if(eT(t))return t.valid;if("function"==typeof l&&!U(e)){let t=l(e);if("boolean"==typeof t)return t;if(eT(t))return t.valid}return!0};function ej(e,t={}){let l="json",r=ek,a=null,o=["",""],n=()=>!0,s=[],i={},u="",c=":",d=!1,p=!1,m=!1,h="~",f="~";if("string"==typeof t)"mongodb"===(l=t.toLowerCase())?a=e$:"parameterized"===l?a=eI:"parameterized_named"===l?a=eI:"cel"===l?a=eg:"spel"===l?a=eG:"jsonlogic"===l?a=eB:"elasticsearch"===l&&(a=eM);else{l=(t.format??"json").toLowerCase();let{valueProcessor:e=null,ruleProcessor:i=null}=t;"function"==typeof i&&(a=i),r="function"==typeof e?(t,l)=>em(e)?e(t.field,t.operator,t.value,t.valueSource):e(t,l):"mongodb"===l?a??e$:"cel"===l?a??eg:"spel"===l?a??eG:"jsonlogic"===l?a??eB:"elasticsearch"==l?a??eM:ek,o=eh(t.quoteFieldNamesWith),n=t.validator??(()=>!0),s=z(t.fields??[]),u=t.fallbackExpression??"",c=t.paramPrefix??":",d=!!t.paramsKeepPrefix,p=!!t.numberedParams,m=!!t.parseNumbers,h=t.placeholderFieldName??"~",f=t.placeholderOperatorName??"~"}if(u||(u="mongodb"===l?'"$and":[{"$expr":true}]':"cel"===l||"spel"===l?"1 == 1":"(1 = 1)"),"json"===l||"json_without_ids"===l){let t=m?ec(e):e;return"json"===l?JSON.stringify(t,null,2):JSON.stringify(t,(e,t)=>"id"===e||"path"===e?void 0:t)}if("function"==typeof n){let t=n(e);if("boolean"==typeof t){if(!1===t)return"parameterized"===l?{sql:u,params:[]}:"parameterized_named"===l?{sql:u,params:{}}:"mongodb"===l?`{${u}}`:"jsonlogic"!==l&&("elasticsearch"===l?{}:u)}else i=t}let b={},g=er(s);g.forEach(e=>{"function"==typeof e.validator&&(b[e.value??e.name]=e.validator)});let v=e=>{let t,l;if(e.id&&(t=i[e.id]),g.length){let t=g.filter(t=>t.name===e.field);if(t.length){let e=t[0];"function"==typeof e.validator&&(l=e.validator)}}return[t,l]};if("sql"===l){let t=(e,n)=>{if(!eU(e,i[e.id??""]))return n?u:"";let c=e.rules.map(n=>{if("string"==typeof n)return n;if(U(n))return t(n,1===e.rules.length);let[i,u]=v(n);if(!eU(n,i,u)||n.field===h||n.operator===f)return"";let c=(n.valueSource??"value")==="value",d=et(s,n.field);return"function"==typeof a?a(n,{parseNumbers:m,escapeQuotes:c,quoteFieldNamesWith:o,fieldData:d,format:l}):eq(n,{parseNumbers:m,escapeQuotes:c,valueProcessor:r,quoteFieldNamesWith:o,fieldData:d,format:l})});return 0===c.length?u:`${e.not?"NOT ":""}(${c.filter(Boolean).join(j(e)?` ${e.combinator} `:" ")})`};return t(e,!0)}if("parameterized"===l||"parameterized_named"===l){let t="parameterized"===l,b=[],g={},$=new Map,y=e=>{$.has(e)||$.set(e,new Set);let t=`${e}_${$.get(e).size+1}`;return $.get(e).add(t),t},E=e=>{let[t,i]=v(e);if(!eU(e,t,i)||e.field===h||e.operator===f)return"";let E=et(s,e.field),N=Object.fromEntries(Array.from($.entries()).map(([e,t])=>[e,Array.from(t)])),G=("function"==typeof a?a:eI)(e,{getNextNamedParam:y,fieldParamNames:N,parseNumbers:m,quoteFieldNamesWith:o,fieldData:E,format:l,paramPrefix:c,paramsKeepPrefix:d,numberedParams:p,fallbackExpression:u,valueProcessor:r,fields:s,placeholderFieldName:h,placeholderOperatorName:f,validator:n},{processedParams:b});if(!T(G))return"";let{sql:R,params:k}=G;return"string"==typeof R&&R?("parameterized"===l&&Array.isArray(k)?b.push(...k):"parameterized_named"===l&&T(k)&&(Object.assign(g,k),Object.keys(k).forEach(t=>$.get(e.field)?.add(t))),R):""},N=(e,t)=>{if(!eU(e,i[e.id??""]))return t?u:"";let l=e.rules.map(t=>"string"==typeof t?t:U(t)?N(t,1===e.rules.length):E(t));return 0===l.length?u:`${e.not?"NOT ":""}(${l.filter(Boolean).join(j(e)?` ${e.combinator} `:" ")})`};return t?{sql:N(e,!0),params:b}:{sql:N(e,!0),params:g}}if("mongodb"===l){let t=(e,o)=>{if(!eU(e,i[e.id??""]))return o?u:"";let n=`"$${e.combinator.toLowerCase()}"`,c=!1,d=e.rules.map(e=>{if(U(e)){let l=t(e);return l?(c=!0,/^\{.+\}$/.test(l)?l:`{${l}}`):""}let[o,n]=v(e);if(!eU(e,o,n)||e.field===h||e.operator===f)return"";let i=et(s,e.field);return(a??r)(e,{parseNumbers:m,fieldData:i,format:l})}).filter(Boolean);return d.length>0?1!==d.length||c?`${n}:[${d.join(",")}]`:d[0]:u},o=t(j(e)?e:P(e),!0);return/^\{.+\}$/.test(o)?o:`{${o}}`}if("cel"===l){let t=(e,o)=>{if(!eU(e,i[e.id??""]))return o?u:"";let n=e.rules.map(e=>{if("string"==typeof e)return eu[e];if(U(e))return t(e);let[o,n]=v(e);if(!eU(e,o,n)||e.field===h||e.operator===f)return"";let i=et(s,e.field);return(a??r)(e,{parseNumbers:m,escapeQuotes:(e.valueSource??"value")==="value",fieldData:i,format:l})}).filter(Boolean).join(j(e)?` ${eu[e.combinator]} `:" "),[c,d]=e.not||!o?[`${e.not?"!":""}(`,")"]:["",""];return n?`${c}${n}${d}`:u};return t(e,!0)}if("spel"===l){let t=(e,o)=>{if(!eU(e,i[e.id??""]))return o?u:"";let n=e.rules.map(e=>{if("string"==typeof e)return e;if(U(e))return t(e);let[o,n]=v(e);if(!eU(e,o,n)||e.field===h||e.operator===f)return"";let i=et(s,e.field);return(a??r)(e,{parseNumbers:m,escapeQuotes:(e.valueSource??"value")==="value",fieldData:i,format:l})}).filter(Boolean).join(j(e)?` ${e.combinator} `:" "),[c,d]=e.not||!o?[`${e.not?"!":""}(`,")"]:["",""];return n?`${c}${n}${d}`:u};return t(e,!0)}if("jsonlogic"===l){let t=j(e)?e:P(e),o=(e,t)=>{if(!eU(e,i[e.id??""]))return!1;let n=e.rules.map(e=>{if(U(e))return o(e);let[t,n]=v(e);if(!eU(e,t,n)||e.field===h||e.operator===f)return!1;let i=et(s,e.field);return(a??r)(e,{parseNumbers:m,fieldData:i,format:l})}).filter(Boolean);if(0===n.length)return!1;let u=1===n.length&&t?n[0]:{[e.combinator]:n};return e.not?{"!":u}:u};return o(t,!0)}if("elasticsearch"===l){let t=j(e)?e:P(e),o=e=>{if(!eU(e,i[e.id??""]))return!1;let t=e.rules.map(e=>{if(U(e))return o(e);let[t,n]=v(e);if(!eU(e,t,n)||e.field===h||e.operator===f)return!1;let i=et(s,e.field);return(a??r)(e,{parseNumbers:m,fieldData:i,format:l})}).filter(Boolean);return 0!==t.length&&{bool:e.not?{must_not:"or"===e.combinator?{bool:{should:t}}:t}:{["or"===e.combinator?"should":"must"]:t}}},n=o(t);return!1===n?{}:n}return""}var eL={default:ek,mongodb:e$,cel:eg,spel:eG},eQ=e=>(t,l,r,a)=>eL[e]({field:t,operator:l,value:r,valueSource:a},{parseNumbers:!1});eQ("default"),eQ("mongodb"),eQ("cel"),eQ("spel");var eH=(e,t)=>{let l=t,r=0;for(;r<e.length&&l&&U(l);){let t=l.rules[e[r]];l="string"!=typeof t?t:null,r++}return l},eP=e=>e.slice(0,e.length-1),eF=(e,t)=>e.length===t.length&&e.every((e,l)=>e===t[l]),e_=(e,t)=>{let l=[],r=eP(e),a=eP(t),o=0;for(;o<r.length&&o<a.length&&r[o]===a[o];)l.push(a[o]),o++;return l},eV=(e,t)=>{let l=!!t.disabled,r=t,a=0;for(;a<e.length&&!l&&U(r);){let t=r.rules[e[a]];T(t)&&(U(t)||"field"in t&&t.field)&&(l=!!t.disabled,r=t),a++}return l},ez=({path:e,qbId:t})=>eF([],e)?"Query builder":`Rule group at path ${e.join("-")}`,eJ=globalThis.crypto,eK=()=>"00-0-4-2-000".replace(/[^-]/g,e=>((Math.random()+~~e)*65536>>parseInt(e)).toString(16).padStart(4,"0"));if(eJ){if("function"==typeof eJ.randomUUID)eK=()=>eJ.randomUUID();else if("function"==typeof eJ.getRandomValues){let e=new Uint32Array(32);eK=()=>{eJ.getRandomValues(e);let t=(e[0]%16).toString(16);for(let l=1;l<32;l++)t=12===l?`${t}4`:16===l?`${t}${"89ab"[e[17]%4]}`:`${t}${(e[l]%16).toString(16)}`,(7===l||11===l||15===l||19===l)&&(t=`${t}-`);return t}}}var eZ=(...e)=>{let t=t=>(0,s.Z)(e.filter(Boolean).map(e=>(0,s.Z)(e[t])));return{queryBuilder:t("queryBuilder"),ruleGroup:t("ruleGroup"),header:t("header"),body:t("body"),combinators:t("combinators"),addRule:t("addRule"),addGroup:t("addGroup"),cloneRule:t("cloneRule"),cloneGroup:t("cloneGroup"),removeGroup:t("removeGroup"),rule:t("rule"),fields:t("fields"),operators:t("operators"),value:t("value"),removeRule:t("removeRule"),notToggle:t("notToggle"),shiftActions:t("shiftActions"),dragHandle:t("dragHandle"),lockRule:t("lockRule"),lockGroup:t("lockGroup"),valueSource:t("valueSource"),actionElement:t("actionElement"),valueSelector:t("valueSelector")}},eX=Object.keys,eY={},e0=(...e)=>{let[t,...l]=e;return(0,n.Uy)(t??eY,e=>{for(let t of l)t&&eX(t).forEach(l=>{e[l]={...e[l],...t[l]}})})},e1=e=>{let t="boolean"==typeof e?e:"object"==typeof e&&null!==e?e.valid:null;return"boolean"==typeof t?t?k.valid:k.invalid:""},e2=["value"],e6={name:"name",value:"name",valueSources:null,label:"label"},e3=(e,t,l)=>{let r=e?V(e):e6;if(r.valueSources)return"function"==typeof r.valueSources?r.valueSources(t):r.valueSources;if(l){let e=l(r.value,t,{fieldData:V(r)});if(e)return e}return e2},e5=(e,{idGenerator:t=eK}={})=>(0,n.Uy)(e,e=>{e.id||(e.id=t())}),e4=(e,{idGenerator:t=eK}={})=>(0,n.Uy)(e,e=>{e.id||(e.id=t()),e.rules=e.rules.map(e=>"string"==typeof e?e:U(e)?e4(e,{idGenerator:t}):e5(e,{idGenerator:t}))}),e7=(e,{idGenerator:t=eK}={})=>U(e)?e4(e,{idGenerator:t}):e5(e,{idGenerator:t}),e8=(e,{idGenerator:t=eK}={})=>JSON.parse(JSON.stringify({...e,id:t()})),e9=(e,{idGenerator:t=eK}={})=>{if(!T(e))return e;if(!U(e))return JSON.parse(JSON.stringify({...e,id:t()}));if(j(e)){let l=e.rules.map(e=>U(e)?e9(e,{idGenerator:t}):e8(e,{idGenerator:t}));return{...e,id:t(),rules:l}}let l=e.rules.map(e=>"string"==typeof e?e:U(e)?e9(e,{idGenerator:t}):e8(e,{idGenerator:t}));return{...e,id:t(),rules:l}},te=(e,t,l,{combinators:r=R,combinatorPreceding:a,idGenerator:o=eK}={})=>(0,n.Uy)(e,e=>{let n=eH(l,e);if(n&&U(n)){if(!j(n)&&n.rules.length>0){let e=n.rules[n.rules.length-2];n.rules.push(a??("string"==typeof e?e:el(r)))}n.rules.push(e7(t,{idGenerator:o}))}}),tt=(e,t,l,r,{resetOnFieldChange:a=!0,resetOnOperatorChange:o=!1,getRuleDefaultOperator:s=()=>"=",getValueSources:i=()=>["value"],getRuleDefaultValue:u=()=>""}={})=>(0,n.Uy)(e,e=>{if("combinator"===t&&!j(e)){let t=eH(eP(r),e).rules;r[r.length-1]%2==1&&(t[r[r.length-1]]=l);return}let n=eH(r,e);if(!n)return;let c=U(n);if(n[t]===l||("valueSource"!==t&&(n[t]=l),c))return;let d=!1,p=!1;a&&"field"===t&&(n.operator=s(l),d=!0,p=!0),o&&"operator"===t&&(d=!0,p=!0);let m=i(n.field,n.operator)[0];(d&&n.valueSource&&m!==n.valueSource||"valueSource"===t&&l!==n.valueSource)&&(p=!!n.valueSource||!n.valueSource&&l!==m,n.valueSource=d?m:l),p&&(n.value=u(n))}),tl=(e,t)=>0!==t.length&&(j(e)||eH(t,e))?(0,n.Uy)(e,e=>{let l=t[t.length-1],r=eH(eP(t),e);r&&U(r)&&(!j(r)&&r.rules.length>1?r.rules.splice(0===l?0:l-1,2):r.rules.splice(l,1))}):e,tr=(e,t,l)=>{if(Array.isArray(l))return l;let r=L(e);if("up"===l){if(eF(t,[0]));else if(0===t.at(-1)){let e=eP(t);return[...eP(e),Math.max(0,e.at(-1)-(r?1:0))]}else{let l=[...eP(t),Math.max(0,t.at(-1)-(r?2:1))],a=eH(l,e);return U(a)?[...l,a.rules.length]:[...eP(t),Math.max(0,t.at(-1)-(r?3:1))]}}else if("down"===l){if(eF([e.rules.length-1],t));else if(t.at(-1)===eH(eP(t),e).rules.length-1){let e=eP(t);return[...eP(e),e.at(-1)+1]}else{let l=[...eP(t),t.at(-1)+(r?2:1)];return U(eH(l,e))?[...l,0]:[...eP(t),t.at(-1)+(r?3:2)]}}return t},ta=(e,t,l,{clone:r=!1,combinators:a=R,idGenerator:o=eK}={})=>{let s=tr(e,t,l);if(0===t.length||eF(t,s)||!eH(eP(s),e))return e;let i=eH(t,e);if(!i)return e;let u=r?U(i)?e9(i,{idGenerator:o}):e8(i,{idGenerator:o}):i;return(0,n.Uy)(e,e=>{let l=L(e),o=eH(eP(t),e),n=t[t.length-1],i=l&&n>0?o.rules[n-1]:null,c=l&&n<o.rules.length-1?o.rules[n+1]:null;r||o.rules.splice(l?Math.max(0,n-1):n,l?2:1);let d=[...s],p=e_(t,s);!r&&t.length===p.length+1&&s[p.length]>t[p.length]&&(d[p.length]-=l?2:1);let m=eH(eP(d),e),h=d[d.length-1],f=(...e)=>m.rules.splice(h,0,...e);0!==m.rules.length&&l?0===h?f(u,0===n&&c?c:m.rules[1]||i||el(a)):f(i||m.rules[h-2]||c||el(a),u):f(u)})},to=e=>Y(e)?e.map(e=>r.createElement("optgroup",{key:e.label,label:e.label},e.options.map(e=>r.createElement("option",{key:e.name,value:e.name,disabled:e.disabled},e.label)))):Array.isArray(e)?e.map(e=>r.createElement("option",{key:e.name,value:e.name,disabled:e.disabled},e.label)):null,tn=(e,t)=>!1!==e&&(!!e||!1!==t),ts=(e,t)=>!!e||!1!==e&&!!t,ti=(e,t,l)=>e?tn(t,l):ts(t,l),tu=(e,t,l)=>(0,r.useMemo)(()=>ti(e,t,l),[l,e,t]),tc=e=>{let t=(0,r.useContext)(tT),l=tu(!0,e.enableMountQueryChange,t.enableMountQueryChange),a=tu(!1,e.enableDragAndDrop,t.enableDragAndDrop)&&!1!==t.enableDragAndDrop,o=tu(!1,e.debugMode,t.debugMode),n=(0,r.useMemo)(()=>eZ(w,t.controlClassnames,e.controlClassnames),[t.controlClassnames,e.controlClassnames]),s=(0,r.useMemo)(()=>{let l={...t.controlElements,...t.controlElements?.actionElement?{addGroupAction:t.controlElements?.addGroupAction??t.controlElements.actionElement,addRuleAction:t.controlElements?.addRuleAction??t.controlElements.actionElement,cloneGroupAction:t.controlElements?.cloneGroupAction??t.controlElements.actionElement,cloneRuleAction:t.controlElements?.cloneRuleAction??t.controlElements.actionElement,lockGroupAction:t.controlElements?.lockGroupAction??t.controlElements.actionElement,lockRuleAction:t.controlElements?.lockRuleAction??t.controlElements.actionElement,removeGroupAction:t.controlElements?.removeGroupAction??t.controlElements.actionElement,removeRuleAction:t.controlElements?.removeRuleAction??t.controlElements.actionElement}:{},...t.controlElements?.valueSelector?{combinatorSelector:t.controlElements?.combinatorSelector??t.controlElements.valueSelector,fieldSelector:t.controlElements?.fieldSelector??t.controlElements.valueSelector,operatorSelector:t.controlElements?.operatorSelector??t.controlElements.valueSelector,valueSourceSelector:t.controlElements?.valueSourceSelector??t.controlElements.valueSelector}:{}},r={...e.controlElements,...e.controlElements?.actionElement?{addGroupAction:e.controlElements?.addGroupAction??e.controlElements.actionElement,addRuleAction:e.controlElements?.addRuleAction??e.controlElements.actionElement,cloneGroupAction:e.controlElements?.cloneGroupAction??e.controlElements.actionElement,cloneRuleAction:e.controlElements?.cloneRuleAction??e.controlElements.actionElement,lockGroupAction:e.controlElements?.lockGroupAction??e.controlElements.actionElement,lockRuleAction:e.controlElements?.lockRuleAction??e.controlElements.actionElement,removeGroupAction:e.controlElements?.removeGroupAction??e.controlElements.actionElement,removeRuleAction:e.controlElements?.removeRuleAction??e.controlElements.actionElement}:{},...e.controlElements?.valueSelector?{combinatorSelector:e.controlElements?.combinatorSelector??e.controlElements.valueSelector,fieldSelector:e.controlElements?.fieldSelector??e.controlElements.valueSelector,operatorSelector:e.controlElements?.operatorSelector??e.controlElements.valueSelector,valueSourceSelector:e.controlElements?.valueSourceSelector??e.controlElements.valueSelector}:{}};return{...tZ,...l,...r}},[e.controlElements,t.controlElements]),i=(0,r.useMemo)(()=>e0(N,t.translations,e.translations),[e.translations,t.translations]),{controlClassnames:u,controlElements:c,debugMode:d,enableDragAndDrop:p,enableMountQueryChange:m,translations:h,...f}=t;return{controlClassnames:n,controlElements:s,debugMode:o,enableDragAndDrop:a,enableMountQueryChange:l,translations:i,...f}},td=(0,i.oM)({name:"queries",initialState:{},reducers:{setQueryState:(e,{payload:{qbId:t,query:l}})=>{e[t]=l}},selectors:{getQuerySelectorById:(e,t)=>e[t]}}),tp={queries:td.getInitialState()},tm=(0,i.xC)({reducer:{queries:td.reducer},preloadedState:tp,middleware:e=>e({serializableCheck:{ignoredActions:["queries/setQueryState"],ignoredPaths:[/^queries\b.*\.rules\.\d+\.value$/]}})}),th=r.createContext(null),tf=(0,a.gR)(th),tb=e=>t=>td.selectors.getQuerySelectorById(t,e),tg=({payload:e,onQueryChange:t})=>l=>{l(td.actions.setQueryState(e)),"function"==typeof t&&t(e.query)},tv=(0,a.AS)(th),t$=(0,a.fw)(th),ty={},tE={},tN=()=>null,tG=()=>"",tR=()=>"",tk=e=>e,tw=e=>e,tC=()=>!0,tA=(...e)=>{console.log(...e)},tS=(e,t,l)=>{let r=el(e);if("between"===t.operator||"notBetween"===t.operator){let e=[r,r];return l?e:O(e.map(e=>e??""),",")}return r},tD=e=>{let t=(0,r.useRef)(eK()),{query:l,defaultQuery:a,fields:o,operators:n,combinators:s=R,translations:i,enableMountQueryChange:u=!0,controlClassnames:c,controlElements:d,getDefaultField:p,getDefaultOperator:m,getDefaultValue:h,getOperators:f,getValueEditorType:b,getValueSources:g,getInputType:v,getValues:$,autoSelectField:y=!0,autoSelectOperator:E=!0,addRuleToNewGroups:N=!1,enableDragAndDrop:k,listsAsArrays:w=!1,debugMode:C=!1,idGenerator:A=eK}=e,S=n??G,D=tc({controlClassnames:c,controlElements:d,debugMode:C,enableDragAndDrop:k,enableMountQueryChange:u,translations:i}),{translations:x}=D,W=(0,r.useMemo)(()=>({id:x.fields.placeholderName,name:x.fields.placeholderName,value:x.fields.placeholderName,label:x.fields.placeholderLabel}),[x.fields.placeholderLabel,x.fields.placeholderName]),O=(0,r.useMemo)(()=>o??[W],[W,o]),B=(0,r.useMemo)(()=>{let e=Array.isArray(O)?z(O):eX(J(O)).map(e=>({...O[e],name:e})).sort((e,t)=>e.label.localeCompare(t.label));return ee(e)?y?Z(e):Z([{label:x.fields.placeholderGroupLabel,options:[W]},...e]):y?K(e):K([W,...e])},[y,W,O,x.fields.placeholderGroupLabel]),I=(0,r.useMemo)(()=>{if(!Array.isArray(O)){let e=J(O);return y?e:{...e,[x.fields.placeholderName]:W}}let e={};return ee(B)?B.forEach(t=>t.options.forEach(t=>{e[t.value??t.name]=V(t)})):B.forEach(t=>{e[t.value??t.name]=V(t)}),e},[y,W,B,O,x.fields.placeholderName]),q=(0,r.useMemo)(()=>z(s),[s]),T=(0,r.useMemo)(()=>({id:x.operators.placeholderName,name:x.operators.placeholderName,value:x.operators.placeholderName,label:x.operators.placeholderLabel}),[x.operators.placeholderLabel,x.operators.placeholderName]),U=(0,r.useCallback)((e,{fieldData:t})=>{let l=z(S);if(t?.operators)l=z(t.operators);else if(f){let r=f(e,{fieldData:t});r&&(l=z(r))}return E||(l=ee(l)?[{label:x.operators.placeholderGroupLabel,options:[T]},...l]:[T,...l]),X(l)},[E,T,f,S,x.operators.placeholderGroupLabel]),j=(0,r.useCallback)(e=>{let t=I[e];return t?.defaultOperator?t.defaultOperator:m?"function"==typeof m?m(e,{fieldData:t}):m:el(U(e,{fieldData:t})??[])??""},[I,m,U]),L=(0,r.useCallback)((e,t,{fieldData:l})=>l.valueEditorType?"function"==typeof l.valueEditorType?l.valueEditorType(t):l.valueEditorType:b?.(e,t,{fieldData:l})??"text",[b]),Q=(0,r.useCallback)((e,t)=>e3(I[e],t,g),[I,g]),H=(0,r.useCallback)((e,t,{fieldData:l})=>l?.values?z(l.values):$?z($(e,t,{fieldData:l})):[],[$]),P=(0,r.useCallback)(e=>{let t=I[e.field];if(t?.defaultValue!==void 0&&null!==t.defaultValue)return t.defaultValue;if(h)return h(e,{fieldData:t});let l="",r=H(e.field,e.operator,{fieldData:t});if("field"===e.valueSource){let r=eo(t,B,e.operator);l=r.length>0?tS(r,e,w):""}else if(r.length){let a=L(e.field,e.operator,{fieldData:t});"multiselect"===a?l=w?[]:"":("select"===a||"radio"===a)&&(l=tS(r,e,w))}else"checkbox"===L(e.field,e.operator,{fieldData:t})&&(l=!1);return l},[I,B,h,L,H,w]),F=(0,r.useCallback)((e,t,{fieldData:l})=>{if(v){let r=v(e,t,{fieldData:l});if(r)return r}return"text"},[v]),_=(0,r.useCallback)(()=>{let e="";if(B?.length>0&&B[0]){let t=el(B);t&&(e=t)}if(p){if("function"==typeof p){let t=p(B);t&&(e=t)}else e=p}let t=j(e),l=Q(e,t)[0]??"value",r={id:A(),field:e,operator:t,valueSource:l,value:""},a=P(r);return{...r,value:a}},[B,p,j,P,Q,A]),Y=(0,r.useCallback)(e=>e?{id:A(),rules:N?[_()]:[],not:!1}:{id:A(),rules:N?[_()]:[],combinator:el(q)??"",not:!1},[N,q,_,A]);return M({defaultQuery:a,queryProp:l}),{qbId:t.current,rqbContext:D,fields:B,fieldMap:I,combinators:q,getOperatorsMain:U,getRuleDefaultOperator:j,getValueEditorTypeMain:L,getValueSourcesMain:Q,getValuesMain:H,getRuleDefaultValue:P,getInputTypeMain:F,createRule:_,createRuleGroup:Y}},tx=(e,t)=>{},tM=e=>{let{id:t,path:l,rule:a,schema:o,actions:{moveRule:n,onPropChange:i,onRuleRemove:u},disabled:c,parentDisabled:d,shiftUpDisabled:p,shiftDownDisabled:m,field:h,operator:f,value:b,valueSource:g,dragMonitorId:v="",dropMonitorId:$="",dndRef:y=null,dragRef:E=null,isDragging:N=!1,isOver:G=!1}=e,{classNames:R,fields:w,fieldMap:C,getInputType:A,getOperators:S,getValueEditorType:D,getValueEditorSeparator:x,getValueSources:M,getValues:W,validationMap:O,enableDragAndDrop:B,getRuleClassname:I}=o;tx(B,!!(v||$||y||E));let q=!!d||!!c,T=(0,r.useMemo)(()=>a||{id:t,field:h??"",operator:f??"",value:b,valueSource:g},[h,t,f,a,b,g]),U=(0,r.useMemo)(()=>({shiftActions:(0,s.W)(k.shiftActions,R.shiftActions),dragHandle:(0,s.W)(k.dragHandle,R.dragHandle),fields:(0,s.W)(k.fields,R.valueSelector,R.fields),operators:(0,s.W)(k.operators,R.valueSelector,R.operators),valueSource:(0,s.W)(k.valueSource,R.valueSelector,R.valueSource),value:(0,s.W)(k.value,R.value),cloneRule:(0,s.W)(k.cloneRule,R.actionElement,R.cloneRule),lockRule:(0,s.W)(k.lockRule,R.actionElement,R.lockRule),removeRule:(0,s.W)(k.removeRule,R.actionElement,R.removeRule)}),[R.shiftActions,R.dragHandle,R.valueSelector,R.fields,R.operators,R.valueSource,R.value,R.actionElement,R.cloneRule,R.lockRule,R.removeRule]),j=(0,r.useCallback)(e=>(t,r)=>{q||i(e,t,l)},[q,i,l]),L=(0,r.useCallback)((e,t)=>{if(!q){let e=[...eP(l),l[l.length-1]+1];n(l,e,!0)}},[q,n,l]),Q=(0,r.useCallback)((e,t)=>{i("disabled",!q,l)},[q,i,l]),H=(0,r.useCallback)((e,t)=>{q||u(l)},[q,u,l]),P=(0,r.useCallback)((e,t)=>{q||p||n(l,"up",e?.altKey)},[q,n,l,p]),F=(0,r.useCallback)((e,t)=>{q||m||n(l,"down",e?.altKey)},[q,n,l,m]),_=(0,r.useMemo)(()=>C?.[T.field]??{name:T.field,value:T.field,label:T.field},[C,T.field]),V=(0,r.useMemo)(()=>_.inputType??A(T.field,T.operator,{fieldData:_}),[_,A,T.field,T.operator]),z=(0,r.useMemo)(()=>S(T.field,{fieldData:_}),[_,S,T.field]),J=(0,r.useMemo)(()=>et(z,T.operator),[z,T.operator]),K=J?.arity,Z=(0,r.useMemo)(()=>"function"==typeof _.valueSources?_.valueSources(T.operator):_.valueSources??M(T.field,T.operator,{fieldData:_}),[_,M,T.field,T.operator]),X=(0,r.useMemo)(()=>"field"===T.valueSource?"select":D(T.field,T.operator,{fieldData:_}),[_,D,T.field,T.operator,T.valueSource]),Y=(0,r.useMemo)(()=>x(T.field,T.operator,{fieldData:_}),[_,x,T.field,T.operator]),ee=(0,r.useMemo)(()=>"field"===T.valueSource?eo(_,w,T.operator):_.values??W(T.field,T.operator,{fieldData:_}),[_,w,W,T.field,T.operator,T.valueSource]),el=(0,r.useMemo)(()=>Z.map(e=>({name:e,value:e,label:e})),[Z]),er=(0,r.useMemo)(()=>O[t??""]??("function"==typeof _.validator?_.validator(T):null),[_,t,T,O]),ea=(0,r.useMemo)(()=>e1(er),[er]),en=(0,r.useMemo)(()=>_?.className??"",[_?.className]),es=(0,r.useMemo)(()=>J?.className??"",[J?.className]),ei=(0,s.W)(I(T,{fieldData:_}),en,es,k.rule,R.rule,{[k.disabled]:q,[k.dndDragging]:N,[k.dndOver]:G},ea);return{...e,classNames:U,cloneRule:L,disabled:q,dndRef:y,dragMonitorId:v,dragRef:E,dropMonitorId:$,fieldData:_,generateOnChangeHandler:j,hideValueControls:"string"==typeof K&&"unary"===K||"number"==typeof K&&K<2,inputType:V,operators:z,outerClassName:ei,removeRule:H,rule:T,shiftRuleUp:P,shiftRuleDown:F,toggleLockRule:Q,validationResult:er,valueEditorSeparator:Y,valueEditorType:X,values:ee,valueSourceOptions:el,valueSources:Z}},tW=e=>{let{id:t,path:l,ruleGroup:a,schema:{qbId:o,accessibleDescriptionGenerator:n,classNames:i,combinators:u,createRule:c,createRuleGroup:d,disabledPaths:p,independentCombinators:m,validationMap:h,enableDragAndDrop:f,getRuleGroupClassname:b},actions:{onGroupAdd:g,onGroupRemove:v,onPropChange:$,onRuleAdd:y,moveRule:E},disabled:N,parentDisabled:G,shiftUpDisabled:R,shiftDownDisabled:w,combinator:C,rules:A,not:S,dragMonitorId:D="",dropMonitorId:x="",previewRef:M=null,dragRef:W=null,dropRef:O=null,isDragging:B=!1,isOver:I=!1}=e;tx(f,!!(D||x||M||W||O));let q=!!G||!!N,T=(0,r.useMemo)(()=>a&&j(a)?a.combinator:a?el(u):C??el(u),[C,u,a]),U=(0,r.useMemo)(()=>a?{...a,...m?{}:{combinator:T}}:{rules:A,not:S},[T,m,S,a,A]),L=(0,r.useMemo)(()=>({header:(0,s.W)(k.header,i.header,{[k.dndOver]:I}),shiftActions:(0,s.W)(k.shiftActions,i.shiftActions),dragHandle:(0,s.W)(k.dragHandle,i.dragHandle),combinators:(0,s.W)(k.combinators,i.valueSelector,i.combinators),notToggle:(0,s.W)(k.notToggle,i.notToggle),addRule:(0,s.W)(k.addRule,i.actionElement,i.addRule),addGroup:(0,s.W)(k.addGroup,i.actionElement,i.addGroup),cloneGroup:(0,s.W)(k.cloneGroup,i.actionElement,i.cloneGroup),lockGroup:(0,s.W)(k.lockGroup,i.actionElement,i.lockGroup),removeGroup:(0,s.W)(k.removeGroup,i.actionElement,i.removeGroup),body:(0,s.W)(k.body,i.body)}),[i.actionElement,i.addGroup,i.addRule,i.body,i.cloneGroup,i.combinators,i.dragHandle,i.header,i.lockGroup,i.notToggle,i.removeGroup,i.shiftActions,i.valueSelector,I]),Q=(0,r.useCallback)((e,t)=>{q||$("combinator",e,l)},[q,$,l]),H=(0,r.useCallback)((e,t,r)=>{q||$("combinator",e,l.concat([t]))},[q,$,l]),P=(0,r.useCallback)((e,t)=>{q||$("not",e,l)},[q,$,l]),F=(0,r.useCallback)((e,t)=>{q||y(c(),l,t)},[c,q,y,l]),_=(0,r.useCallback)((e,t)=>{q||g(d(m),l,t)},[d,q,m,g,l]),V=(0,r.useCallback)((e,t)=>{if(!q){let e=[...eP(l),l[l.length-1]+1];E(l,e,!0)}},[q,E,l]),z=(0,r.useCallback)((e,t)=>{q||R||E(l,"up",e?.altKey)},[q,E,l,R]),J=(0,r.useCallback)((e,t)=>{q||w||E(l,"down",e?.altKey)},[q,E,l,w]),K=(0,r.useCallback)((e,t)=>{$("disabled",!q,l)},[q,$,l]),Z=(0,r.useCallback)((e,t)=>{q||v(l)},[q,v,l]),X=(0,r.useMemo)(()=>h[t??""],[t,h]),Y=(0,r.useMemo)(()=>e1(X),[X]),ee=(0,r.useMemo)(()=>m?null:et(u,T)?.className??"",[T,u,m]),er=(0,r.useMemo)(()=>b(U),[b,U]),ea=(0,r.useMemo)(()=>(0,s.W)(er,ee,k.ruleGroup,i.ruleGroup,{[k.disabled]:q,[k.dndDragging]:B},Y),[i.ruleGroup,ee,q,er,B,Y]),eo=(0,r.useMemo)(()=>{let e=[];for(let t=0;t<U.rules.length;t++){let r=[...l,t];e[t]={path:r,disabled:q||p.some(e=>eF(r,e))}}return e},[q,l,U.rules.length,p]),en=(0,r.useMemo)(()=>n({path:l,qbId:o}),[n,l,o]);return{...e,addGroup:_,addRule:F,accessibleDescription:en,classNames:L,cloneGroup:V,combinator:T,disabled:q,dragMonitorId:D,dragRef:W,dropMonitorId:x,dropRef:O,isDragging:B,isOver:I,onCombinatorChange:Q,onGroupAdd:g,onIndependentCombinatorChange:H,onNotToggleChange:P,outerClassName:ea,parentDisabled:G,pathsMemo:eo,previewRef:M,removeGroup:Z,ruleGroup:U,shiftGroupUp:z,shiftGroupDown:J,toggleLockGroup:K,validationClassName:Y,validationResult:X}},tO=({multiple:e,onChange:t})=>(0,r.useMemo)(()=>e?e=>t(Array.from(e.target.selectedOptions).map(e=>e.value)):e=>t(e.target.value),[e,t]),tB=e=>(0,r.useCallback)((t,l)=>{t?.preventDefault(),t?.stopPropagation(),e(t,l)},[e]),tI=({handleOnChange:e,inputType:t,operator:l,value:a,listsAsArrays:o,parseNumbers:s,values:i,type:u,skipHook:c})=>{(0,r.useEffect)(()=>{!c&&"multiselect"!==u&&!["between","notBetween","in","notIn"].includes(l)&&(Array.isArray(a)||"number"===t&&"string"==typeof a&&a.includes(","))&&e(I(a)[0]??"")},[e,t,l,c,u,a]);let d=(0,r.useMemo)(()=>I(a),[a]),p=(0,r.useCallback)((t,r)=>{let a=(0,n.Uy)(d,e=>{e[r]=en(t,{parseNumbers:s}),0===r&&("between"===l||"notBetween"===l)&&(e.length<2||void 0===e[1])&&(e[1]=el(i))});e(o?a:O(a,","))},[e,o,l,s,d,i]);return{valueAsArray:d,multiValueHandler:p}},tq=({handleOnChange:e,listsAsArrays:t=!1,multiple:l=!1,value:a})=>({onChange:(0,r.useCallback)(r=>{if(l){let l=I(r);e(t?l:O(l,","))}else e(r)},[e,t,l]),val:(0,r.useMemo)(()=>l?I(a):a,[l,a])}),tT=(0,r.createContext)({});tT.displayName="QueryBuilderContext";var tU=[],tj=({children:e})=>r.createElement(a.zt,{context:th,store:tm},e),tL=({setup:e,props:t})=>{let l=function(e,t){let{query:l,defaultQuery:a,getValueEditorSeparator:o=tN,getRuleClassname:n=tG,getRuleGroupClassname:i=tR,onAddRule:u=tk,onAddGroup:c=tw,onRemove:d=tC,onQueryChange:p,showCombinatorsBetweenRules:m=!1,showNotToggle:h=!1,showShiftActions:f=!1,showCloneButtons:b=!1,showLockButtons:g=!1,resetOnFieldChange:v=!0,resetOnOperatorChange:$=!1,autoSelectField:y=!0,autoSelectOperator:E=!0,addRuleToNewGroups:N=!1,listsAsArrays:G=!1,parseNumbers:R=!1,disabled:w=!1,validator:C,onLog:S=tA,idGenerator:D,accessibleDescriptionGenerator:x=ez}=e,{qbId:M,rqbContext:W,fields:O,fieldMap:B,combinators:I,getOperatorsMain:q,getRuleDefaultOperator:T,getValueEditorTypeMain:U,getValueSourcesMain:Q,getValuesMain:H,getRuleDefaultValue:P,getInputTypeMain:F,createRule:_,createRuleGroup:V}=t,{controlClassnames:z,controlElements:J,debugMode:K,enableDragAndDrop:Z,enableMountQueryChange:X,translations:Y}=W,ee=!!m,et=!!h,el=!!f,er=!!b,ea=!!g,eo=!!v,en=!!$,es=!!y,ei=!!E,eu=!!N,ec=!!G,ed=t$(),ep=tv(),em=(0,r.useMemo)(()=>tb(t.qbId),[t.qbId]),eh=tf(em),ef=(0,r.useCallback)(()=>em(ed.getState()),[ed,em]),eb=(0,r.useMemo)(()=>V(),[V]),eg=l??eh??a??eb,ev=eg.id?eg:e4(eg,{idGenerator:D});(0,r.useEffect)(()=>{l&&l!==eh&&ep(tg({payload:{qbId:M,query:l},onQueryChange:void 0}))},[l,M,eh,ep]);let e$=(0,r.useMemo)(()=>L(ev),[ev]),ey=!!e.independentCombinators&&!e$;ey||ey||e.independentCombinators,(0,r.useEffect)(()=>{ep(tg({payload:{qbId:M,query:ev},onQueryChange:X&&"function"==typeof p?p:void 0}))},[]);let eE=(0,r.useCallback)(e=>{ep(tg({payload:{qbId:M,query:e},onQueryChange:p}))},[p,M,ep]),eN=(0,r.useMemo)(()=>Array.isArray(w)&&w||[],[w]),eG=!0===w,eR=(0,r.useMemo)(()=>ev.disabled||eN.some(e=>0===e.length),[eN,ev.disabled]),ek=(0,r.useCallback)((e,t,l)=>{let r=tb(M)(ed.getState());if(!r)return;if(eV(t,r)||eG){K&&S({type:A.parentPathDisabled,rule:e,parentPath:t,query:r});return}let a=u(e,t,r,l);if(!a){K&&S({type:A.onAddRuleFalse,rule:e,parentPath:t,query:r});return}let o=te(r,a,t,{combinators:I,combinatorPreceding:a.combinatorPreceding??void 0});K&&S({type:A.add,query:r,newQuery:o,newRule:a,parentPath:t}),eE(o)},[I,K,eE,u,S,M,eG,ed]),ew=(0,r.useCallback)((e,t,l)=>{let r=tb(M)(ed.getState());if(!r)return;if(eV(t,r)||eG){K&&S({type:A.parentPathDisabled,ruleGroup:e,parentPath:t,query:r});return}let a=c(e,t,r,l);if(!a){K&&S({type:A.onAddGroupFalse,ruleGroup:e,parentPath:t,query:r});return}let o=te(r,a,t,{combinators:I,combinatorPreceding:a.combinatorPreceding??void 0});K&&S({type:A.add,query:r,newQuery:o,newGroup:a,parentPath:t}),eE(o)},[I,K,eE,c,S,M,eG,ed]),eC=(0,r.useCallback)((e,t,l)=>{let r=tb(M)(ed.getState());if(!r)return;if(eV(l,r)&&"disabled"!==e||eG){K&&S({type:A.pathDisabled,path:l,prop:e,value:t,query:r});return}let a=tt(r,e,t,l,{resetOnFieldChange:eo,resetOnOperatorChange:en,getRuleDefaultOperator:T,getValueSources:Q,getRuleDefaultValue:P});K&&S({type:A.update,query:r,newQuery:a,prop:e,value:t,path:l}),eE(a)},[K,eE,T,P,Q,S,M,eG,ed,eo,en]),eA=(0,r.useCallback)((e,t)=>{let l=tb(M)(ed.getState());if(!l)return;if(eV(e,l)||eG){K&&S({type:A.pathDisabled,path:e,query:l});return}let r=eH(e,l);if(r){if(d(r,e,l,t)){let t=tl(l,e);K&&S({type:A.remove,query:l,newQuery:t,path:e,ruleOrGroup:r}),eE(t)}else K&&S({type:A.onRemoveFalse,ruleOrGroup:r,path:e,query:l})}},[K,eE,S,d,M,eG,ed]),eS=(0,r.useCallback)((e,t,l)=>{let r=tb(M)(ed.getState());if(!r)return;if(eV(e,r)||eG){K&&S({type:A.pathDisabled,oldPath:e,newPath:t,query:r});return}let a=ta(r,e,t,{clone:l,combinators:I});K&&S({type:A.move,query:r,newQuery:a,oldPath:e,newPath:t,clone:l}),eE(a)},[I,K,eE,S,M,eG,ed]),eD=(0,r.useMemo)(()=>Z?"enabled":"disabled",[Z]),ex=(0,r.useMemo)(()=>e$||ee?"enabled":"disabled",[e$,ee]),eM=(0,r.useMemo)(()=>j(ev)?{combinator:ev.combinator}:{},[ev]),{validationResult:eW,validationMap:eO}=(0,r.useMemo)(()=>{let e="function"==typeof C&&ev?C(ev):ty;return{validationResult:e,validationMap:"boolean"==typeof e?tE:e}},[ev,C]),eB=(0,r.useMemo)(()=>({addRuleToNewGroups:eu,accessibleDescriptionGenerator:x,autoSelectField:es,autoSelectOperator:ei,classNames:z,combinators:I,controls:J,createRule:_,createRuleGroup:V,disabledPaths:eN,enableDragAndDrop:Z,fieldMap:B,fields:O,dispatchQuery:eE,getQuery:ef,getInputType:F,getOperators:q,getRuleClassname:n,getRuleGroupClassname:i,getValueEditorSeparator:o,getValueEditorType:U,getValues:H,getValueSources:Q,independentCombinators:e$,listsAsArrays:ec,parseNumbers:R,qbId:M,showCloneButtons:er,showCombinatorsBetweenRules:ee,showLockButtons:ea,showNotToggle:et,showShiftActions:el,validationMap:eO}),[eu,x,es,ei,I,z,J,_,V,eN,Z,B,O,eE,ef,F,q,n,i,U,H,Q,o,e$,ec,R,M,er,ee,ea,et,el,eO]),eI=(0,r.useMemo)(()=>({moveRule:eS,onGroupAdd:ew,onGroupRemove:eA,onPropChange:eC,onRuleAdd:ek,onRuleRemove:eA}),[eS,ew,eC,ek,eA]),eq=(0,r.useMemo)(()=>(0,s.W)(k.queryBuilder,(0,s.W)(z.queryBuilder),{[k.disabled]:eG,[k.valid]:"boolean"==typeof eW&&eW,[k.invalid]:"boolean"==typeof eW&&!eW}),[z.queryBuilder,eG,eW]);return{...e,actions:eI,rootGroup:ev,rootGroupDisabled:eR,queryDisabled:eG,rqbContext:W,schema:eB,translations:Y,wrapperClassName:eq,dndEnabledAttr:eD,inlineCombinatorsAttr:ex,combinatorPropObject:eM}}(t,e),a=l.schema.controls.ruleGroup;return r.createElement(tT.Provider,{key:l.dndEnabledAttr,value:l.rqbContext},r.createElement("div",{role:"form",className:l.wrapperClassName,"data-dnd":l.dndEnabledAttr,"data-inlinecombinators":l.inlineCombinatorsAttr},r.createElement(a,{translations:l.translations,ruleGroup:l.rootGroup,rules:l.rootGroup.rules,...l.combinatorPropObject,not:!!l.rootGroup.not,schema:l.schema,actions:l.actions,id:l.rootGroup.id,path:tU,disabled:l.rootGroupDisabled,shiftUpDisabled:!0,shiftDownDisabled:!0,parentDisabled:l.queryDisabled,context:l.context})))},tQ=e=>{let t=tD(e);return r.createElement(tj,null,r.createElement(tL,{props:e,setup:t}))};tQ.displayName="QueryBuilder";var tH=r.memo(e=>{let t=tM(e);return t.cloneRule=tB(t.cloneRule),t.toggleLockRule=tB(t.toggleLockRule),t.removeRule=tB(t.removeRule),t.shiftRuleUp=tB(t.shiftRuleUp),t.shiftRuleDown=tB(t.shiftRuleDown),r.createElement("div",{ref:t.dndRef,"data-testid":C.rule,"data-dragmonitorid":t.dragMonitorId,"data-dropmonitorid":t.dropMonitorId,className:t.outerClassName,"data-rule-id":t.id,"data-level":t.path.length,"data-path":JSON.stringify(t.path)},r.createElement(tP,{...t}))});tH.displayName="Rule";var tP=r.memo(e=>{let{schema:{controls:{shiftActions:t,dragHandle:l,fieldSelector:a,operatorSelector:o,valueSourceSelector:n,valueEditor:s,cloneRuleAction:i,lockRuleAction:u,removeRuleAction:c}}}=e;return r.createElement(r.Fragment,null,e.schema.showShiftActions&&r.createElement(t,{testID:C.shiftActions,level:e.path.length,path:e.path,titles:{shiftUp:e.translations.shiftActionUp.title,shiftDown:e.translations.shiftActionDown.title},labels:{shiftUp:e.translations.shiftActionUp.label,shiftDown:e.translations.shiftActionDown.label},className:e.classNames.shiftActions,disabled:e.disabled,shiftUp:e.shiftRuleUp,shiftDown:e.shiftRuleDown,shiftUpDisabled:e.shiftUpDisabled,shiftDownDisabled:e.shiftDownDisabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.rule}),e.schema.enableDragAndDrop&&r.createElement(l,{testID:C.dragHandle,ref:e.dragRef,level:e.path.length,path:e.path,title:e.translations.dragHandle.title,label:e.translations.dragHandle.label,className:e.classNames.dragHandle,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.rule}),r.createElement(a,{testID:C.fields,options:e.schema.fields,title:e.translations.fields.title,value:e.rule.field,operator:e.rule.operator,className:e.classNames.fields,handleOnChange:e.generateOnChangeHandler("field"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),(e.schema.autoSelectField||e.rule.field!==e.translations.fields.placeholderName)&&r.createElement(r.Fragment,null,r.createElement(o,{testID:C.operators,field:e.rule.field,fieldData:e.fieldData,title:e.translations.operators.title,options:e.operators,value:e.rule.operator,className:e.classNames.operators,handleOnChange:e.generateOnChangeHandler("operator"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),(e.schema.autoSelectOperator||e.rule.operator!==e.translations.operators.placeholderName)&&!e.hideValueControls&&r.createElement(r.Fragment,null,!["null","notNull"].includes(e.rule.operator)&&e.valueSources.length>1&&r.createElement(n,{testID:C.valueSourceSelector,field:e.rule.field,fieldData:e.fieldData,title:e.translations.valueSourceSelector.title,options:e.valueSourceOptions,value:e.rule.valueSource??"value",className:e.classNames.valueSource,handleOnChange:e.generateOnChangeHandler("valueSource"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}),r.createElement(s,{testID:C.valueEditor,field:e.rule.field,fieldData:e.fieldData,title:e.translations.value.title,operator:e.rule.operator,value:e.rule.value,valueSource:e.rule.valueSource??"value",type:e.valueEditorType,inputType:e.inputType,values:e.values,listsAsArrays:e.schema.listsAsArrays,parseNumbers:e.schema.parseNumbers,separator:e.valueEditorSeparator,className:e.classNames.value,handleOnChange:e.generateOnChangeHandler("value"),level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,rule:e.rule}))),e.schema.showCloneButtons&&r.createElement(i,{testID:C.cloneRule,label:e.translations.cloneRule.label,title:e.translations.cloneRule.title,className:e.classNames.cloneRule,handleOnClick:e.cloneRule,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}),e.schema.showLockButtons&&r.createElement(u,{testID:C.lockRule,label:e.translations.lockRule.label,title:e.translations.lockRule.title,className:e.classNames.lockRule,handleOnClick:e.toggleLockRule,level:e.path.length,path:e.path,disabled:e.disabled,disabledTranslation:e.parentDisabled?void 0:e.translations.lockRuleDisabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}),r.createElement(c,{testID:C.removeRule,label:e.translations.removeRule.label,title:e.translations.removeRule.title,className:e.classNames.removeRule,handleOnClick:e.removeRule,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.rule,schema:e.schema}))}),tF=r.memo(e=>{let t=tW(e);return t.addRule=tB(t.addRule),t.addGroup=tB(t.addGroup),t.cloneGroup=tB(t.cloneGroup),t.toggleLockGroup=tB(t.toggleLockGroup),t.removeGroup=tB(t.removeGroup),t.shiftGroupUp=tB(t.shiftGroupUp),t.shiftGroupDown=tB(t.shiftGroupDown),r.createElement("div",{ref:t.previewRef,title:t.accessibleDescription,className:t.outerClassName,"data-testid":C.ruleGroup,"data-dragmonitorid":t.dragMonitorId,"data-dropmonitorid":t.dropMonitorId,"data-rule-group-id":t.id,"data-level":t.path.length,"data-path":JSON.stringify(t.path)},r.createElement("div",{ref:t.dropRef,className:t.classNames.header},r.createElement(t_,{...t})),r.createElement("div",{className:t.classNames.body},r.createElement(tV,{...t})))});tF.displayName="RuleGroup";var t_=r.memo(e=>{let{schema:{controls:{shiftActions:t,dragHandle:l,combinatorSelector:a,notToggle:o,addRuleAction:n,addGroupAction:s,cloneGroupAction:i,lockGroupAction:u,removeGroupAction:c}}}=e;return r.createElement(r.Fragment,null,e.schema.showShiftActions&&e.path.length>0&&r.createElement(t,{key:C.shiftActions,testID:C.shiftActions,level:e.path.length,path:e.path,titles:{shiftUp:e.translations.shiftActionUp.title,shiftDown:e.translations.shiftActionDown.title},labels:{shiftUp:e.translations.shiftActionUp.label,shiftDown:e.translations.shiftActionDown.label},className:e.classNames.shiftActions,disabled:e.disabled,shiftUp:e.shiftGroupUp,shiftDown:e.shiftGroupDown,shiftUpDisabled:e.shiftUpDisabled,shiftDownDisabled:e.shiftDownDisabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.ruleGroup}),e.path.length>0&&e.schema.enableDragAndDrop&&r.createElement(l,{key:C.dragHandle,testID:C.dragHandle,ref:e.dragRef,level:e.path.length,path:e.path,title:e.translations.dragHandle.title,label:e.translations.dragHandle.label,className:e.classNames.dragHandle,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema,ruleOrGroup:e.ruleGroup}),!e.schema.showCombinatorsBetweenRules&&!e.schema.independentCombinators&&r.createElement(a,{key:C.combinators,testID:C.combinators,options:e.schema.combinators,value:e.combinator,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:e.onCombinatorChange,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,schema:e.schema}),e.schema.showNotToggle&&r.createElement(o,{key:C.notToggle,testID:C.notToggle,className:e.classNames.notToggle,title:e.translations.notToggle.title,label:e.translations.notToggle.label,checked:e.ruleGroup.not,handleOnChange:e.onNotToggleChange,level:e.path.length,disabled:e.disabled,path:e.path,context:e.context,validation:e.validationResult,schema:e.schema,ruleGroup:e.ruleGroup}),r.createElement(n,{key:C.addRule,testID:C.addRule,label:e.translations.addRule.label,title:e.translations.addRule.title,className:e.classNames.addRule,handleOnClick:e.addRule,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),r.createElement(s,{key:C.addGroup,testID:C.addGroup,label:e.translations.addGroup.label,title:e.translations.addGroup.title,className:e.classNames.addGroup,handleOnClick:e.addGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.schema.showCloneButtons&&e.path.length>=1&&r.createElement(i,{key:C.cloneGroup,testID:C.cloneGroup,label:e.translations.cloneRuleGroup.label,title:e.translations.cloneRuleGroup.title,className:e.classNames.cloneGroup,handleOnClick:e.cloneGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.schema.showLockButtons&&r.createElement(u,{key:C.lockGroup,testID:C.lockGroup,label:e.translations.lockGroup.label,title:e.translations.lockGroup.title,className:e.classNames.lockGroup,handleOnClick:e.toggleLockGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,disabledTranslation:e.parentDisabled?void 0:e.translations.lockGroupDisabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}),e.path.length>0&&r.createElement(c,{key:C.removeGroup,testID:C.removeGroup,label:e.translations.removeGroup.label,title:e.translations.removeGroup.title,className:e.classNames.removeGroup,handleOnClick:e.removeGroup,rules:e.ruleGroup.rules,level:e.path.length,path:e.path,disabled:e.disabled,context:e.context,validation:e.validationResult,ruleOrGroup:e.ruleGroup,schema:e.schema}))}),tV=r.memo(e=>{let{schema:{controls:{combinatorSelector:t,inlineCombinator:l,ruleGroup:a,rule:o}}}=e;return r.createElement(r.Fragment,null,e.ruleGroup.rules.map((n,s,{length:i})=>{let u=e.pathsMemo[s],c=u.path,d=u.disabled||"string"!=typeof n&&n.disabled,p=eF([0],c),m=0===e.path.length&&s===i-1,h="string"==typeof n?[...c,n].join("-"):n.id;return r.createElement(r.Fragment,{key:h},s>0&&!e.schema.independentCombinators&&e.schema.showCombinatorsBetweenRules&&r.createElement(l,{key:C.inlineCombinator,options:e.schema.combinators,value:e.combinator,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:e.onCombinatorChange,rules:e.ruleGroup.rules,level:e.path.length,context:e.context,validation:e.validationResult,component:t,path:c,disabled:e.disabled,independentCombinators:e.schema.independentCombinators,schema:e.schema}),"string"==typeof n?r.createElement(l,{key:`${C.inlineCombinator}-independent`,options:e.schema.combinators,value:n,title:e.translations.combinators.title,className:e.classNames.combinators,handleOnChange:t=>e.onIndependentCombinatorChange(t,s),rules:e.ruleGroup.rules,level:e.path.length,context:e.context,validation:e.validationResult,component:t,path:c,disabled:d,independentCombinators:e.schema.independentCombinators,schema:e.schema}):U(n)?r.createElement(a,{key:C.ruleGroup,id:n.id,schema:e.schema,actions:e.actions,path:c,translations:e.translations,ruleGroup:n,rules:n.rules,combinator:j(n)?n.combinator:void 0,not:!!n.not,disabled:d,parentDisabled:e.parentDisabled||e.disabled,shiftUpDisabled:p,shiftDownDisabled:m,context:e.context}):r.createElement(o,{key:C.rule,id:n.id,rule:n,field:n.field,operator:n.operator,value:n.value,valueSource:n.valueSource,schema:e.schema,actions:e.actions,path:c,disabled:d,parentDisabled:e.parentDisabled||e.disabled,translations:e.translations,shiftUpDisabled:p,shiftDownDisabled:m,context:e.context}))}))}),tz=({disabled:e,shiftUp:t,shiftDown:l,shiftUpDisabled:a,shiftDownDisabled:o,className:n,labels:s,titles:i,testID:u})=>r.createElement("div",{"data-testid":u,className:n},r.createElement("button",{disabled:e||a,onClick:t,title:i?.shiftUp},s?.shiftUp),r.createElement("button",{disabled:e||o,onClick:l,title:i?.shiftDown},s?.shiftDown));tz.displayName="ShiftActions";var tJ=e=>{let{operator:t,value:l,handleOnChange:a,title:o,className:n,type:s="text",inputType:i="text",values:u=[],listsAsArrays:c,parseNumbers:d,fieldData:p,disabled:m,separator:h=null,testID:f,selectorComponent:b=e.schema.controls.valueSelector,...g}=e,{valueAsArray:v,multiValueHandler:$}=tI(e);if("null"===t||"notNull"===t)return null;let y=p?.placeholder??"",E=["in","notIn"].includes(t)?"text":i||"text";if(("between"===t||"notBetween"===t)&&("select"===s||"text"===s)){let t=["from","to"].map((t,l)=>"text"===s?r.createElement("input",{key:t,type:E,placeholder:y,value:v[l]??"",className:k.valueListItem,disabled:m,onChange:e=>$(e.target.value,l)}):r.createElement(b,{...g,schema:e.schema,key:t,className:k.valueListItem,handleOnChange:e=>$(e,l),disabled:m,value:v[l]??el(u),options:u,listsAsArrays:c}));return r.createElement("span",{"data-testid":f,className:n,title:o},t[0],h,t[1])}switch(s){case"select":case"multiselect":return r.createElement(b,{...g,schema:e.schema,testID:f,className:n,title:o,handleOnChange:a,disabled:m,value:l,options:u,multiple:"multiselect"===s,listsAsArrays:c});case"textarea":return r.createElement("textarea",{"data-testid":f,placeholder:y,value:l,title:o,className:n,disabled:m,onChange:e=>a(e.target.value)});case"switch":case"checkbox":return r.createElement("input",{"data-testid":f,type:"checkbox",className:n,title:o,onChange:e=>a(e.target.checked),checked:!!l,disabled:m});case"radio":return r.createElement("span",{"data-testid":f,className:n,title:o},u.map(e=>r.createElement("label",{key:e.name},r.createElement("input",{type:"radio",value:e.name,disabled:m,checked:l===e.name,onChange:e=>a(e.target.value)}),e.label)))}return r.createElement("input",{"data-testid":f,type:E,placeholder:y,value:l,title:o,className:n,disabled:m,onChange:e=>a(en(e.target.value,{parseNumbers:d}))})};tJ.displayName="ValueEditor";var tK=({className:e,handleOnChange:t,options:l,title:a,value:o,multiple:n,listsAsArrays:s,disabled:i,testID:u})=>{let{onChange:c,val:d}=tq({handleOnChange:t,listsAsArrays:s,multiple:n,value:o}),p=tO({multiple:n,onChange:c});return r.createElement("select",{"data-testid":u,className:e,value:d,title:a,disabled:i,multiple:!!n,onChange:p},to(l))};tK.displayName="ValueSelector";var tZ={actionElement:v,addGroupAction:v,addRuleAction:v,cloneGroupAction:v,cloneRuleAction:v,combinatorSelector:tK,dragHandle:$,fieldSelector:tK,inlineCombinator:S,lockGroupAction:v,lockRuleAction:v,notToggle:D,operatorSelector:tK,removeGroupAction:v,removeRuleAction:v,rule:tH,ruleGroup:tF,shiftActions:tz,valueEditor:tJ,valueSelector:tK,valueSourceSelector:tK}}}]);