!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},a=Error().stack;a&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[a]="c714351a-965a-4d3b-a4d5-f4d0cd8f253b",e._sentryDebugIdIdentifier="sentry-dbid-c714351a-965a-4d3b-a4d5-f4d0cd8f253b")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[427],{71413:function(e,a,l){l.r(a),l.d(a,{default:function(){return H}});var t=l(57437),s=l(26564),i=l(19153),n=l(87884),d=l(14265),r=l(90666),c=l(41650),o=l(85598),u=l(2265),x=l(16347),v=l(35067),p=l(22485),h=l(71888),g=l(81898),m=l(37431),f=l(32303),b=l(23064),j=l(11388),y=l(36085),S=l(4319),I=l(96986),N=l(37087),C=l(29424),w=l(83073),A=l(21996);function E(e){let{props:a}=e,{ratesMethod:l,setRatesMethod:s,datasetId:i,setDatasetId:n,eventVariable:d,setEventVariable:r,baseVariable:c,setBaseVariable:o,weightsId:u,setWeightsId:v}=a,p=(0,x.v9)(e=>e.root.weights);return(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)(S.g,{label:"Method",size:"sm",onSelectionChange:e=>{s(e.currentKey)},defaultSelectedKeys:[Object.values(N.G9)[0]],children:Object.values(N.G9).map(e=>(0,t.jsx)(I.R,{value:e,children:e},e))}),(0,t.jsx)(A.N,{datasetId:i,setDatasetId:e=>{n(e)}}),(0,t.jsx)(C.W3,{dataId:i,setVariable:e=>{r(e)},label:"Event Variable",size:"sm",defaultVariable:d}),(0,t.jsx)(C.W3,{dataId:i,setVariable:e=>{o(e)},label:"Base Variable",size:"sm",defaultVariable:c}),l.startsWith("Spatial")&&(0,t.jsx)(w.a5,{weights:p,weightsId:u,onSelectWeights:e=>{v(e)}})]})}var G=l(7528),M=l(53254);function D(e){let{datasetId:a,setDatasetId:l,variable:s,setVariable:i,variableType:n=C.o1.Numeric,onSelectionChange:d,datasetLabel:r,variableLabel:c,size:o}=e,v=(0,x.v9)(G.Sh),p=(0,x.v9)((0,G.pK)(a)),h=(0,u.useMemo)(()=>(0,C.Ir)(p,n),[p,n]);return(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)(M.d,{label:r||"Select a dataset",className:"max-w",onSelectionChange:e=>{d({dataId:e,variable:s}),l(e)},size:o||"md",selectedKey:p.id,isInvalid:!p||0===p.id.length,children:null==v?void 0:v.map((e,a)=>(0,t.jsx)(I.R,{value:e.dataId,children:e.fileName},e.dataId||a))}),(0,t.jsx)(M.d,{label:c||"Select a variable",className:"max-w",onSelectionChange:e=>{d({variable:e,dataId:null==p?void 0:p.id}),i(e)},size:o||"md",selectedKey:s,isInvalid:!s||0===s.length,children:h.map(e=>(0,t.jsx)(I.R,{value:e,children:e},e))})]})}let R=[{label:"Quantile",value:h.Yd.QUANTILE},{label:"Natural Breaks",value:h.Yd.NATURAL_BREAK},{label:"Equal Interval",value:h.Yd.EQUAL_INTERVAL},{label:"Percentile",value:h.Yd.PERCENTILE},{label:"Box (Hinge=1.5)",value:h.Yd.BOX_MAP_15},{label:"Box (Hinge=3.0)",value:h.Yd.BOX_MAP_30},{label:"Standard Deviation",value:h.Yd.STD_MAP},{label:"Unique Values",value:h.Yd.UNIQUE_VALUES},{label:"Co-location",value:h.Yd.COLOCATION,disabled:!0}],k=Array.from({length:19},(e,a)=>a+2).map(e=>({label:"".concat(e),value:e}));function T(e){let{props:a}=e,{k:l,setK:s,datasetId:d,setDatasetId:r,variable:c,setVariable:o,mappingType:u,setMappingType:x,eventVariable:v,setEventVariable:p,baseVariable:h,setBaseVariable:g,weightsId:m,setWeightsId:f,ratesMethod:b,setRatesMethod:N,selectedColorRange:C,setSelectedColorRange:w,setIsRatesMap:A}=a;return(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsxs)(i.n,{variant:"underlined","aria-label":"classification-tabs",onSelectionChange:e=>{null==A||A("rate-mapping"===e)},children:[(0,t.jsx)(n.r,{title:"Basic Mapping",children:(0,t.jsx)(D,{datasetId:d,setDatasetId:r,variable:c,setVariable:o,onSelectionChange:e=>{let{variable:a,dataId:l}=e;o(a||""),r(l||"")}})},"basic-mapping"),(0,t.jsx)(n.r,{title:"Rate Mapping",children:(0,t.jsx)(E,{props:{ratesMethod:b,setRatesMethod:N,datasetId:d,setDatasetId:r,eventVariable:v,setEventVariable:p,baseVariable:h,setBaseVariable:g,weightsId:m,setWeightsId:f}})},"rate-mapping")]},"classification-panel-tabs"),(0,t.jsx)(S.g,{label:"Classification Method",className:"max-w",onSelectionChange:e=>{x(e.currentKey)},selectedKeys:[u],disabledKeys:R.filter(e=>e.disabled).map(e=>e.value),children:R.map(e=>(0,t.jsx)(I.R,{value:e.value,children:e.label},e.value))}),(0,t.jsx)(S.g,{label:"Number of Categories",className:"max-w",onSelectionChange:e=>{let a=Number(e.currentKey);s(a),w((0,j.mH)(a,C))},selectedKeys:["".concat(l)],children:k.map(e=>(0,t.jsx)(I.R,{value:e.value,children:e.label},e.value))}),(0,t.jsx)(y.c,{numberOfColors:l,defaultColorRange:null==C?void 0:C.name,onSelectColorRange:e=>{w(e)}})]})}var _=l(44702),B=l(66262);let O=v.ITH.get(v.pio),L=v.ITH.get(v.BVv),V=v.ITH.get(v.qOV),K=v.ITH.get(v.brd),Y=v.ITH.get(v.mtp);var H=function(){let e=(0,s.Z)(),a=(0,x.I0)(),{visStateActions:l,uiStateActions:y,mapStyleActions:S}=(0,v.pfw)()(e=>a((0,f.wrapTo)(h.EG,e)),{}),I=(0,x.v9)(e=>{var a,l;return null===(l=e.keplerGl[h.EG])||void 0===l?void 0:null===(a=l.visState)||void 0===a?void 0:a.datasets}),C=(0,x.v9)(e=>{var a,l;return null===(l=e.keplerGl[h.EG])||void 0===l?void 0:null===(a=l.visState)||void 0===a?void 0:a.layers}),w=(0,x.v9)(e=>{var a,l;return null===(l=e.keplerGl[h.EG])||void 0===l?void 0:null===(a=l.visState)||void 0===a?void 0:a.interactionConfig}),A=(0,x.v9)(e=>{var a,l;return null===(l=e.keplerGl[h.EG])||void 0===l?void 0:null===(a=l.visState)||void 0===a?void 0:a.layerOrder}),E=(0,x.v9)(G.YA),[M,D]=(0,u.useState)(E),R=(0,x.v9)(e=>{var a;return null===(a=e.keplerGl[h.EG])||void 0===a?void 0:a.mapStyle}),[k,H]=(0,u.useState)(!1),[P,U]=(0,u.useState)(5),[z,Q]=(0,u.useState)(""),[W,q]=(0,u.useState)(""),[X,F]=(0,u.useState)(""),[Z,J]=(0,u.useState)(""),[$,ee]=(0,u.useState)(h.Yd.QUANTILE),[ea,el]=(0,u.useState)((0,j.Hc)(P)),[et,es]=(0,u.useState)(N.G9.RawRates),ei=async()=>{M&&(!1===k?a((0,B.ch)({dataId:M,variable:z,classficationMethod:$,numberOfCategories:P,colorRange:ea})):X&&W&&X.length>0&&W.length>0&&et&&et.length>0&&a((0,B.xZ)({dataId:M,method:et,eventVariable:X,baseVariable:W,classficationMethod:$,numberOfCategories:P,colorRange:ea,weightsId:Z})))},en=(0,u.useMemo)(()=>k?!W||!X||!$||P<=0:!z||!$||P<=0,[k,W,X,z,$,P]);return(0,t.jsx)(m.c,{title:e.formatMessage({id:"mapping.title",defaultMessage:"Map"}),description:e.formatMessage({id:"mapping.description",defaultMessage:"Create and manage your maps"}),icon:null,children:0===I.length?(0,t.jsx)(g.Xr,{message:"Please load a map first before creating and managing your maps.",type:g.Bc.WARNING}):(0,t.jsx)("div",{className:"h-full overflow-y-auto p-4",children:(0,t.jsxs)(i.n,{"aria-label":"Options",variant:"solid",color:"danger",classNames:{},size:"md",children:[(0,t.jsx)(n.r,{title:(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsx)("span",{children:"Add Map"})}),children:(0,t.jsx)(d.w,{children:(0,t.jsx)(r.G,{children:(0,t.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,t.jsx)(T,{props:{k:P,setK:U,datasetId:M,setDatasetId:D,variable:z,setVariable:Q,mappingType:$,setMappingType:ee,ratesMethod:et,setRatesMethod:es,selectedColorRange:ea,setSelectedColorRange:el,weightsId:Z,setWeightsId:J,baseVariable:W,setBaseVariable:q,eventVariable:X,setEventVariable:F,setIsRatesMap:H}}),(0,t.jsx)(c.q,{y:2}),(0,t.jsx)(_.X,{onClick:ei,isDisabled:en,children:"Create a New Map Layer"})]})})})},"map-creation"),(0,t.jsx)(n.r,{title:(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsx)("span",{children:"Manage Maps"})}),children:(0,t.jsx)(d.w,{children:(0,t.jsx)(r.G,{className:"flex flex-col gap-4",children:(0,t.jsxs)(v.V25.Provider,{value:{id:h.EG,selector:e=>e.keplerGl[h.EG]},children:[(0,t.jsx)(d.w,{children:(0,t.jsx)(r.G,{children:(0,t.jsx)(O,{datasets:I,showDatasetTable:!1,showDeleteDataset:!0,updateTableColor:(e,l)=>{a((0,f.updateTableColor)(e,l))},removeDataset:y.openDeleteModal,showDatasetList:!0,showAddDataModal:y.showAddDataModal})})}),(0,t.jsxs)(d.w,{children:[(0,t.jsx)(o.u,{children:(0,t.jsx)("p",{className:"text-tiny tracking-[1.25px] text-[#A0A7B4] dark:text-[#6A7485]",children:"Layers"})}),(0,t.jsx)(r.G,{children:(0,t.jsx)(K,{children:(0,t.jsx)(L,{datasets:I,layers:C,layerOrder:A,layerClasses:p.LayerClasses,uiStateActions:y,visStateActions:l})})})]}),(0,t.jsxs)(d.w,{children:[(0,t.jsx)(o.u,{children:(0,t.jsx)("p",{className:"text-tiny tracking-[1.25px] text-[#A0A7B4] dark:text-[#6A7485]",children:"Tooltip"})}),(0,t.jsx)(r.G,{children:(0,t.jsx)(Y,{datasets:I,config:w.tooltip.config,onChange:e=>{a((0,f.interactionConfigChange)({...w.tooltip,config:{...w.tooltip.config,...e}}))},onDisplayFormatChange:l.setColumnDisplayFormat})})]})]})})})},"map-layers"),(0,t.jsx)(n.r,{title:(0,t.jsx)("div",{className:"flex items-center space-x-2",children:(0,t.jsx)("span",{children:"Basemap"})}),children:(0,t.jsx)(d.w,{children:(0,t.jsx)(r.G,{children:(0,t.jsx)(V,{mapStyle:R,mapStyleActions:S,panelMetadata:b.SIDEBAR_PANELS[3]})})})},"basemap")]})})})}}}]);